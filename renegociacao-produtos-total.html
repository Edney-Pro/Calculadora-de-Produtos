<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RenegociaÃ§Ã£o - DÃ­vida Total - Encomenda Palotina</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --magalu-blue: #007bff;
            --magalu-dark-blue: #0056b3;
            --magalu-light-blue: #e3f2fd;
            --success: #28a745;
            --warning: #ffc107;
            --light-yellow: #fff3cd;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .calculator-container {
            width: 100%;
            min-height: 100vh;
            background: white;
            margin: 0;
            border-radius: 0;
        }
        
        .calculator-header {
            background: linear-gradient(135deg, var(--magalu-blue), var(--magalu-dark-blue));
            color: white;
            padding: 1.5rem 1rem;
            position: relative;
        }
        
        .debt-item {
            border-left: 4px solid var(--magalu-blue);
            background: var(--magalu-light-blue);
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 10px;
        }
        
        .installment-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--success);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            border: none;
            font-weight: 600;
            border-radius: 8px;
            color: white;
        }
        
        .btn-primary {
            background: var(--magalu-blue);
            border-color: var(--magalu-blue);
            font-weight: 600;
            border-radius: 8px;
        }
        
        .btn-reset {
            background: var(--light-yellow);
            border: 2px solid #ffc107;
            color: #856404;
            font-weight: 600;
        }
        
        .btn-reset:hover {
            background: #ffeaa7;
            color: #856404;
        }
        
        .btn-back {
            background: #6c757d;
            border: none;
            color: white;
            font-weight: 600;
        }
        
        .section-title {
            color: var(--magalu-blue);
            border-left: 4px solid var(--magalu-blue);
            padding-left: 12px;
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        .entry-section {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
        }
        
        .summary-section {
            background: #e8f5e8;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
        }
        
        .footer-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            border-top: 2px solid #e9ecef;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .content-area {
            padding-bottom: 120px;
        }
        
        .conditions-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .phase-box {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid var(--magalu-blue);
        }
        
        .phase-title {
            font-weight: 600;
            color: var(--magalu-blue);
            margin-bottom: 0.5rem;
        }
        
        .value-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--magalu-blue);
        }
        
        /* SLIDERS CORRIGIDOS */
        .slider-container {
            padding: 0 1rem;
            position: relative;
        }
        
        .custom-slider {
            width: 100%;
            height: 6px;
            background: #dee2e6;
            border-radius: 3px;
            border: none;
            outline: none;
            margin: 20px 0;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--magalu-blue);
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .custom-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--magalu-blue);
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: -10px;
            font-size: 0.8rem;
            color: #666;
        }
        
        /* OtimizaÃ§Ãµes para mobile */
        .form-control, .btn {
            font-size: 16px !important;
        }
        
        @media (max-width: 768px) {
            .calculator-header {
                padding: 1rem;
            }
            
            .installment-display {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <!-- Header -->
        <div class="calculator-header text-center">
            <h1 style="font-size: 1.5rem; margin: 0;"><i class="bi bi-wallet2 me-2"></i>DÃ­vida Total</h1>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; opacity: 0.9;">Consolide todas as suas dÃ­vidas em uma Ãºnica</p>
        </div>

        <!-- ConteÃºdo Principal -->
        <div class="content-area">
            <div class="p-3">
                <!-- Dados do Cliente -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-person-badge me-2"></i>Seus Dados</h4>
                    <div class="row g-2">
                        <div class="col-12">
                            <input type="text" class="form-control" id="clientName" placeholder="Nome completo">
                        </div>
                        <div class="col-12">
                            <input type="text" class="form-control" id="clientCPF" placeholder="CPF (000.000.000-00)">
                        </div>
                    </div>
                </div>

                <!-- CondiÃ§Ãµes Especiais -->
                <div class="conditions-box">
                    <h5 class="text-center mb-3"><i class="bi bi-info-circle me-2"></i>CondiÃ§Ãµes para DÃ­vida Total</h5>
                    <div class="phase-box">
                        <div class="phase-title">ðŸ“‹ CondiÃ§Ãµes Gerais</div>
                        <div>â€¢ Entrada obrigatÃ³ria: <strong>50%</strong></div>
                        <div>â€¢ Parcela mÃ­nima: <strong>R$ 150,00</strong></div>
                    </div>
                    <div class="phase-box">
                        <div class="phase-title">ðŸ”„ 1Âª Fase - Parcelamento da Entrada</div>
                        <div>â€¢ Parcelamento da entrada de <strong>50%</strong></div>
                        <div>â€¢ Taxa: <strong>4% ao mÃªs</strong></div>
                        <div>â€¢ MÃ¡ximo: <strong>24 parcelas</strong></div>
                    </div>
                    <div class="phase-box">
                        <div class="phase-title">ðŸ“ˆ 2Âª Fase - Parcelamento do Restante</div>
                        <div>â€¢ Parcelamento dos <strong>50%</strong> restantes</div>
                        <div>â€¢ Taxa: <strong>3.5% ao mÃªs</strong></div>
                        <div>â€¢ MÃ¡ximo: <strong>60 parcelas</strong></div>
                    </div>
                </div>

                <!-- DÃ­vidas -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-receipt me-2"></i>Valor Total das DÃ­vidas</h4>
                    <div id="debtsContainer">
                        <!-- DÃ­vidas serÃ£o adicionadas aqui -->
                    </div>
                    <button class="btn btn-outline-primary w-100 mt-2" onclick="addDebt()">
                        <i class="bi bi-plus-circle me-1"></i>Adicionar Valor
                    </button>
                </div>

                <!-- Valores Calculados -->
                <div class="entry-section">
                    <h4 class="section-title"><i class="bi bi-calculator me-2"></i>Valores Calculados</h4>
                    <div class="row text-center mb-3">
                        <div class="col-6">
                            <div class="value-display" id="entryValueDisplay">R$ 0,00</div>
                            <small>Entrada (50%)</small>
                        </div>
                        <div class="col-6">
                            <div class="value-display" id="remainingValueDisplay">R$ 0,00</div>
                            <small>Valor Restante (50%)</small>
                        </div>
                    </div>
                </div>

                <!-- Parcelas 1Âª Fase - ENTRADA (MÃXIMO 24x) -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-calendar-range me-2"></i>1Âª Fase - Parcelamento da Entrada</h4>
                    <div class="slider-container">
                        <input type="range" class="custom-slider" id="firstPhaseRange" min="1" max="24" value="1">
                        <div class="slider-labels">
                            <span>1x</span>
                            <span>24x</span>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <div class="installment-display" id="firstPhaseDisplay">R$ 0,00</div>
                        <small class="text-muted fw-semibold">
                            <span id="firstPhaseValue">1</span> parcela â€¢ 4% a.m.
                        </small>
                    </div>
                </div>

                <!-- Parcelas 2Âª Fase - VALOR RESTANTE (MÃXIMO 60x) -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-calendar-range me-2"></i>2Âª Fase - Parcelamento do Restante</h4>
                    <div class="slider-container">
                        <input type="range" class="custom-slider" id="secondPhaseRange" min="1" max="60" value="1">
                        <div class="slider-labels">
                            <span>1x</span>
                            <span>60x</span>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <div class="installment-display" id="secondPhaseDisplay">R$ 0,00</div>
                        <small class="text-muted fw-semibold">
                            <span id="secondPhaseValue">1</span> parcela â€¢ 3.5% a.m.
                        </small>
                    </div>
                </div>

                <!-- Resumo (inicialmente escondido) -->
                <div class="summary-section hidden" id="summarySection">
                    <h5 class="text-center mb-3"><i class="bi bi-file-text me-2"></i>Resumo da RenegociaÃ§Ã£o</h5>
                    <div id="summaryContent">
                        <!-- ConteÃºdo do resumo serÃ¡ gerado aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- RodapÃ© com AÃ§Ãµes -->
        <div class="footer-actions">
            <div class="row g-2">
                <div class="col-4">
                    <button class="btn btn-back w-100" onclick="goBackToHome()">
                        <i class="bi bi-house me-1"></i>Home
                    </button>
                </div>
                <div class="col-4">
                    <button class="btn btn-reset w-100" onclick="resetCalculator()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Nova
                    </button>
                </div>
                <div class="col-4">
                    <button class="btn btn-whatsapp w-100" onclick="showSummary()">
                        <i class="bi bi-eye me-1"></i>Ver Resumo
                    </button>
                </div>
                <div class="col-12 mt-2 hidden" id="whatsappButton">
                    <button class="btn btn-whatsapp w-100" onclick="sendWhatsApp()">
                        <i class="bi bi-whatsapp me-1"></i>Enviar WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // VariÃ¡veis globais
        let debtCount = 0;

        // InicializaÃ§Ã£o
        document.addEventListener('DOMContentLoaded', function() {
            addDebt();
            updateCalculations();
            setupEventListeners();
        });

        // Configura event listeners
        function setupEventListeners() {
            document.getElementById('firstPhaseRange').addEventListener('input', updateCalculations);
            document.getElementById('secondPhaseRange').addEventListener('input', updateCalculations);
        }

        // FunÃ§Ã£o para voltar para home
        function goBackToHome() {
            window.location.href = 'index.html';
        }

        // Adicionar dÃ­vida (APENAS VALOR - SEM DESCRIÃ‡ÃƒO)
        function addDebt() {
            if (debtCount >= 10) {
                alert('MÃ¡ximo de 10 valores atingido!');
                return;
            }

            debtCount++;
            const debtId = `debt-${debtCount}`;
            
            const debtHTML = `
                <div class="debt-item" id="${debtId}">
                    <div class="row g-2 align-items-center">
                        <div class="col-12">
                            <input type="text" class="form-control debt-value" placeholder="R$ 0,00" oninput="formatCurrency(this); updateCalculations()">
                        </div>
                        <div class="col-12 text-end mt-1">
                            ${debtCount > 1 ? 
                                `<button class="btn btn-danger btn-sm" onclick="removeDebt('${debtId}')">
                                    <i class="bi bi-trash"></i> Remover
                                </button>` : 
                                ''
                            }
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('debtsContainer').insertAdjacentHTML('beforeend', debtHTML);
            updateCalculations();
        }

        // Remover dÃ­vida
        function removeDebt(debtId) {
            const debtElement = document.getElementById(debtId);
            if (debtElement) {
                debtElement.remove();
                debtCount--;
                updateCalculations();
            }
        }

        // FormataÃ§Ã£o de moeda
        function formatCurrency(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value === '') {
                input.value = '';
                return;
            }
            
            let number = parseInt(value) / 100;
            input.value = formatCurrencyValue(number);
        }

        // Formata valor para moeda
        function formatCurrencyValue(value) {
            return value.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
        }

        // ObtÃ©m valor numÃ©rico do campo de moeda
        function getCurrencyValue(currencyString) {
            if (!currencyString) return 0;
            let value = currencyString.replace('R$', '')
                                    .replace(/\./g, '')
                                    .replace(',', '.')
                                    .trim();
            return parseFloat(value) || 0;
        }

        // Calcula total das dÃ­vidas
        function calculateTotalDebts() {
            let total = 0;
            const debtElements = document.querySelectorAll('.debt-item');
            
            debtElements.forEach(debtElement => {
                const valueInput = debtElement.querySelector('.debt-value');
                const value = getCurrencyValue(valueInput.value);
                total += value;
            });
            
            return total;
        }

        // CÃ¡lculo do valor da parcela com juros (INTERNO - CLIENTE NÃƒO VÃŠ)
        function calculateInstallment(totalValue, installments, interestRate) {
            if (installments === 1) return totalValue;
            if (installments === 0) return 0;
            
            const numerator = interestRate * Math.pow(1 + interestRate, installments);
            const denominator = Math.pow(1 + interestRate, installments) - 1;
            
            return totalValue * (numerator / denominator);
        }

        // FunÃ§Ã£o para calcular datas CORRIGIDA
        function calculateDates(firstPhaseInstallments, secondPhaseInstallments) {
            const today = new Date();
            
            // 1Âª FASE - Entrada
            const firstPaymentPhase1 = new Date(today);
            firstPaymentPhase1.setMonth(firstPaymentPhase1.getMonth() + 1);
            
            const lastPaymentPhase1 = new Date(firstPaymentPhase1);
            lastPaymentPhase1.setMonth(lastPaymentPhase1.getMonth() + firstPhaseInstallments - 1);
            
            // 2Âª FASE - Restante (INICIA APÃ“S tÃ©rmino da 1Âª fase)
            const firstPaymentPhase2 = new Date(lastPaymentPhase1);
            firstPaymentPhase2.setMonth(firstPaymentPhase2.getMonth() + 1);
            
            const lastPaymentPhase2 = new Date(firstPaymentPhase2);
            lastPaymentPhase2.setMonth(lastPaymentPhase2.getMonth() + secondPhaseInstallments - 1);
            
            return {
                firstPaymentPhase1: firstPaymentPhase1,
                lastPaymentPhase1: lastPaymentPhase1,
                firstPaymentPhase2: firstPaymentPhase2,
                lastPaymentPhase2: lastPaymentPhase2
            };
        }

        // Atualiza todos os cÃ¡lculos
        function updateCalculations() {
            const totalDebts = calculateTotalDebts();
            const firstPhaseInstallments = parseInt(document.getElementById('firstPhaseRange').value);
            const secondPhaseInstallments = parseInt(document.getElementById('secondPhaseRange').value);
            
            // Atualiza valores dos sliders
            document.getElementById('firstPhaseValue').textContent = firstPhaseInstallments;
            document.getElementById('secondPhaseValue').textContent = secondPhaseInstallments;
            
            // Calcula valores fixos (50% entrada, 50% restante)
            const entryValue = totalDebts * 0.50; // 50% entrada
            const remainingValue = totalDebts * 0.50; // 50% restante
            
            // Atualiza displays dos valores
            document.getElementById('entryValueDisplay').textContent = formatCurrencyValue(entryValue);
            document.getElementById('remainingValueDisplay').textContent = formatCurrencyValue(remainingValue);
            
            // 1Âª FASE: Parcelamento da ENTRADA (4% a.m.)
            let firstPhaseValue = 0;
            if (entryValue > 0 && firstPhaseInstallments > 0) {
                firstPhaseValue = calculateInstallment(entryValue, firstPhaseInstallments, 0.04); // 4% a.m.
            }
            document.getElementById('firstPhaseDisplay').textContent = formatCurrencyValue(firstPhaseValue);
            
            // 2Âª FASE: Parcelamento do RESTANTE (3.5% a.m.)
            let secondPhaseValue = 0;
            if (remainingValue > 0 && secondPhaseInstallments > 0) {
                secondPhaseValue = calculateInstallment(remainingValue, secondPhaseInstallments, 0.035); // 3.5% a.m.
            }
            document.getElementById('secondPhaseDisplay').textContent = formatCurrencyValue(secondPhaseValue);
        }

        // Mostrar resumo CORRIGIDO
        function showSummary() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientCPF = document.getElementById('clientCPF').value.trim();
            const totalDebts = calculateTotalDebts();
            
            // ValidaÃ§Ãµes
            if (!clientName) {
                alert('Por favor, informe seu nome.');
                return;
            }
            
            if (!clientCPF || clientCPF.replace(/\D/g, '').length !== 11) {
                alert('Por favor, informe um CPF vÃ¡lido.');
                return;
            }
            
            if (totalDebts === 0) {
                alert('Por favor, adicione pelo menos um valor.');
                return;
            }
            
            const firstPhaseInstallments = parseInt(document.getElementById('firstPhaseRange').value);
            const secondPhaseInstallments = parseInt(document.getElementById('secondPhaseRange').value);
            const firstPhaseValue = getCurrencyValue(document.getElementById('firstPhaseDisplay').textContent);
            const secondPhaseValue = getCurrencyValue(document.getElementById('secondPhaseDisplay').textContent);
            const entryValue = totalDebts * 0.50;
            const remainingValue = totalDebts * 0.50;
            
            // Calcula datas CORRETAS
            const dates = calculateDates(firstPhaseInstallments, secondPhaseInstallments);
            const today = new Date();
            
            // Monta resumo CORRETO - PARCELAS NÃƒO SOMAM
            const summaryHTML = `
                <div class="mb-3">
                    <strong>Data da Proposta:</strong> ${today.toLocaleDateString('pt-BR')}
                </div>
                <div class="mb-3">
                    <strong>Cliente:</strong> ${clientName}<br>
                    <strong>CPF:</strong> ${clientCPF}
                </div>
                <div class="mb-3">
                    <strong>Valor Total Consolidado:</strong><br>
                    <div class="d-flex justify-content-between fw-bold fs-5">
                        <span>Total:</span>
                        <span>${formatCurrencyValue(totalDebts)}</span>
                    </div>
                </div>
                
                <div class="mb-3 p-3 bg-light rounded">
                    <strong>ðŸ”„ 1Âª FASE - ENTRADA</strong><br>
                    <div class="fw-bold">${firstPhaseInstallments}x de ${formatCurrencyValue(firstPhaseValue)}</div>
                    <small class="text-muted">
                        InÃ­cio: ${dates.firstPaymentPhase1.toLocaleDateString('pt-BR')}<br>
                        TÃ©rmino: ${dates.lastPaymentPhase1.toLocaleDateString('pt-BR')}<br>
                        <em>Taxa: 4% ao mÃªs</em>
                    </small>
                </div>
                
                <div class="mb-3 p-3 bg-light rounded">
                    <strong>ðŸ“ˆ 2Âª FASE - VALOR RESTANTE</strong><br>
                    <div class="fw-bold">${secondPhaseInstallments}x de ${formatCurrencyValue(secondPhaseValue)}</div>
                    <small class="text-muted">
                        InÃ­cio: ${dates.firstPaymentPhase2.toLocaleDateString('pt-BR')}<br>
                        TÃ©rmino: ${dates.lastPaymentPhase2.toLocaleDateString('pt-BR')}<br>
                        <em>Taxa: 3.5% ao mÃªs</em><br>
                        <em>Inicia apÃ³s tÃ©rmino da 1Âª fase</em>
                    </small>
                </div>
                
                <div class="mb-3">
                    <strong>Resumo do Pagamento:</strong><br>
                    â€¢ Primeiros ${firstPhaseInstallments} meses: ${formatCurrencyValue(firstPhaseValue)}<br>
                    â€¢ PrÃ³ximos ${secondPhaseInstallments} meses: ${formatCurrencyValue(secondPhaseValue)}<br>
                    â€¢ Total de meses: <strong>${firstPhaseInstallments + secondPhaseInstallments} meses</strong>
                </div>
            `;
            
            document.getElementById('summaryContent').innerHTML = summaryHTML;
            document.getElementById('summarySection').classList.remove('hidden');
            document.getElementById('whatsappButton').classList.remove('hidden');
            
            // Scroll para o resumo
            document.getElementById('summarySection').scrollIntoView({ behavior: 'smooth' });
        }

        // Enviar para WhatsApp CORRIGIDO
        function sendWhatsApp() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientCPF = document.getElementById('clientCPF').value.trim();
            const totalDebts = calculateTotalDebts();
            const firstPhaseInstallments = parseInt(document.getElementById('firstPhaseRange').value);
            const secondPhaseInstallments = parseInt(document.getElementById('secondPhaseRange').value);
            const firstPhaseValue = getCurrencyValue(document.getElementById('firstPhaseDisplay').textContent);
            const secondPhaseValue = getCurrencyValue(document.getElementById('secondPhaseDisplay').textContent);
            
            // Calcula datas CORRETAS
            const dates = calculateDates(firstPhaseInstallments, secondPhaseInstallments);
            const today = new Date();
            
            const message = `*ðŸ’° PROPOSTA - CONSOLIDAÃ‡ÃƒO DÃVIDA TOTAL*\n\n` +
                           `*Data:* ${today.toLocaleDateString('pt-BR')}\n` +
                           `*Cliente:* ${clientName}\n` +
                           `*CPF:* ${clientCPF}\n\n` +
                           `*VALOR TOTAL CONSOLIDADO: ${formatCurrencyValue(totalDebts)}*\n\n` +
                           `*ðŸ”„ 1Âª FASE - ENTRADA (${firstPhaseInstallments}x)*\n` +
                           `Parcela: ${formatCurrencyValue(firstPhaseValue)}\n` +
                           `InÃ­cio: ${dates.firstPaymentPhase1.toLocaleDateString('pt-BR')}\n` +
                           `TÃ©rmino: ${dates.lastPaymentPhase1.toLocaleDateString('pt-BR')}\n` +
                           `*Taxa: 4% ao mÃªs*\n\n` +
                           `*ðŸ“ˆ 2Âª FASE - VALOR RESTANTE (${secondPhaseInstallments}x)*\n` +
                           `Parcela: ${formatCurrencyValue(secondPhaseValue)}\n` +
                           `InÃ­cio: ${dates.firstPaymentPhase2.toLocaleDateString('pt-BR')}\n` +
                           `TÃ©rmino: ${dates.lastPaymentPhase2.toLocaleDateString('pt-BR')}\n` +
                           `*Taxa: 3.5% ao mÃªs*\n` +
                           `*Inicia apÃ³s tÃ©rmino da 1Âª fase*\n\n` +
                           `*RESUMO DO PAGAMENTO:*\n` +
                           `â€¢ Primeiros ${firstPhaseInstallments} meses: ${formatCurrencyValue(firstPhaseValue)}\n` +
                           `â€¢ PrÃ³ximos ${secondPhaseInstallments} meses: ${formatCurrencyValue(secondPhaseValue)}\n` +
                           `â€¢ Total: ${firstPhaseInstallments + secondPhaseInstallments} meses\n\n` +
                           `_*Proposta sujeita Ã  anÃ¡lise e aprovaÃ§Ã£o*_\n` +
                           `ðŸ“ž *Encomenda Palotina*\n` +
                           `ðŸ’š https://wa.me/554498408460`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/554498408460?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // Reset da calculadora
        function resetCalculator() {
            if (confirm('Deseja comeÃ§ar uma nova simulaÃ§Ã£o?')) {
                document.getElementById('clientName').value = '';
                document.getElementById('clientCPF').value = '';
                document.getElementById('firstPhaseRange').value = 1;
                document.getElementById('secondPhaseRange').value = 1;
                document.getElementById('summarySection').classList.add('hidden');
                document.getElementById('whatsappButton').classList.add('hidden');
                
                // Remove todas as dÃ­vidas exceto a primeira
                const debtsContainer = document.getElementById('debtsContainer');
                const firstDebt = debtsContainer.querySelector('.debt-item');
                
                debtsContainer.innerHTML = '';
                if (firstDebt) {
                    debtsContainer.appendChild(firstDebt);
                    firstDebt.querySelector('.debt-value').value = '';
                }
                
                debtCount = 1;
                updateCalculations();
            }
        }

        // FormataÃ§Ã£o automÃ¡tica do CPF
        document.getElementById('clientCPF').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            if (value.length > 3) value = value.replace(/^(\d{3})(\d)/, '$1.$2');
            if (value.length > 6) value = value.replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3');
            if (value.length > 9) value = value.replace(/^(\d{3})\.(\d{3})\.(\d{3})(\d)/, '$1.$2.$3-$4');
            e.target.value = value;
        });
    </script>
</body>
</html>