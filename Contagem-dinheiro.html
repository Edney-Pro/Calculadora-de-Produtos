<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Contagem de Dinheiro - Encomenda Palotina</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --magalu-blue: #007bff;
            --magalu-dark-blue: #0056b3;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-family: 'Segoe UI', sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .calculator-container {
            width: 100%;
            min-height: 100vh;
            background: white;
        }
        
        .calculator-header {
            background: linear-gradient(135deg, var(--magalu-blue), var(--magalu-dark-blue));
            color: white;
            padding: 1.5rem 1rem;
        }
        
        .money-section {
            background: #f8f9fa;
            padding: 1rem;
            margin: 1rem;
            border-radius: 10px;
            border-left: 4px solid var(--magalu-blue);
        }
        
        .section-bills { border-left-color: var(--success); }
        .section-coins { border-left-color: var(--warning); }
        .section-checks { border-left-color: var(--danger); }
        .section-banks { border-left-color: var(--info); }
        
        .total-display {
            font-size: 2rem;
            font-weight: bold;
            color: var(--success);
        }
        
        .sub-total {
            font-size: 1.2rem;
            font-weight: 600;
            color: #495057;
        }
        
        .btn-back {
            background: #6c757d;
            border: none;
            color: white;
            font-weight: 600;
        }
        
        .btn-reset {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            font-weight: 600;
        }
        
        .footer-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            border-top: 2px solid #e9ecef;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .content-area {
            padding-bottom: 120px;
        }
        
        .money-item {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: white;
            border-radius: 8px;
        }
        
        .chart-container {
            height: 200px;
            margin: 1rem 0;
        }
        
     .summary-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
    margin-top: 1rem;
}

.summary-item {
    background: white;
    padding: 0.8rem;
    border-radius: 8px;
    text-align: center;
    border: 2px solid #e9ecef;
}

.summary-item.total {
    grid-column: 1 / -1;
    background: linear-gradient(135deg, var(--success), #1e7e34);
    color: white;
    font-weight: bold;
    border: none;
}

/* Garantir que o texto do total seja visível */
.summary-item.total .sub-total,
.summary-item.total .total-display {
    color: white !important;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}
        
        .add-button {
            background: var(--magalu-blue);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <!-- Header -->
        <div class="calculator-header text-center">
            <h1 style="font-size: 1.5rem; margin: 0;"><i class="bi bi-cash-stack me-2"></i>Contagem de Dinheiro</h1>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; opacity: 0.9;">Some cédulas, moedas, cheques e bancos</p>
        </div>

        <!-- Conteúdo -->
        <div class="content-area">
            <!-- Cédulas -->
            <div class="money-section section-bills">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h4 class="mb-0"><i class="bi bi-bank me-2"></i>Cédulas</h4>
                    <span class="sub-total" id="billsTotal">R$ 0,00</span>
                </div>
                <div id="billsContainer">
                    <!-- Cédulas serão geradas aqui -->
                </div>
            </div>

            <!-- Moedas -->
            <div class="money-section section-coins">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h4 class="mb-0"><i class="bi bi-coin me-2"></i>Moedas</h4>
                    <span class="sub-total" id="coinsTotal">R$ 0,00</span>
                </div>
                <div id="coinsContainer">
                    <!-- Moedas serão geradas aqui -->
                </div>
            </div>

            <!-- Cheques -->
            <div class="money-section section-checks">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h4 class="mb-0"><i class="bi bi-receipt me-2"></i>Cheques</h4>
                    <div>
                        <span class="sub-total" id="checksTotal">R$ 0,00</span>
                        <button class="add-button" onclick="addCheck()" id="addCheckBtn">+</button>
                    </div>
                </div>
                <div id="checksContainer">
                    <!-- Cheques serão gerados aqui -->
                </div>
            </div>

            <!-- Bancos -->
            <div class="money-section section-banks">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h4 class="mb-0"><i class="bi bi-building me-2"></i>Bancos</h4>
                    <div>
                        <span class="sub-total" id="banksTotal">R$ 0,00</span>
                        <button class="add-button" onclick="addBank()" id="addBankBtn">+</button>
                    </div>
                </div>
                <div id="banksContainer">
                    <!-- Bancos serão gerados aqui -->
                </div>
            </div>

            <!-- Gráfico -->
            <div class="money-section">
                <h4 class="text-center mb-3"><i class="bi bi-pie-chart me-2"></i>Distribuição do Dinheiro</h4>
                <div class="chart-container">
                    <canvas id="moneyChart"></canvas>
                </div>
            </div>

            <!-- Resumo -->
            <div class="money-section">
                <h4 class="text-center mb-3"><i class="bi bi-calculator me-2"></i>Resumo Total</h4>
                <div class="summary-grid">
                    <div class="summary-item">
                        <small>Cédulas</small>
                        <div class="sub-total" id="summaryBills">R$ 0,00</div>
                    </div>
                    <div class="summary-item">
                        <small>Moedas</small>
                        <div class="sub-total" id="summaryCoins">R$ 0,00</div>
                    </div>
                    <div class="summary-item">
                        <small>Cheques</small>
                        <div class="sub-total" id="summaryChecks">R$ 0,00</div>
                    </div>
                    <div class="summary-item">
                        <small>Bancos</small>
                        <div class="sub-total" id="summaryBanks">R$ 0,00</div>
                    </div>
                    <div class="summary-item total">
                        <div>TOTAL GERAL</div>
                        <div class="total-display" id="totalDisplay">R$ 0,00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rodapé -->
        <div class="footer-actions">
            <div class="row g-2">
                <div class="col-6">
                    <button class="btn btn-back w-100" onclick="goBackToHome()">
                        <i class="bi bi-house me-1"></i>Voltar para Home
                    </button>
                </div>
                <div class="col-6">
                    <button class="btn btn-reset w-100" onclick="resetCalculator()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Zerar Tudo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados iniciais
        const bills = [
            { value: 200, label: "R$ 200,00" },
            { value: 100, label: "R$ 100,00" },
            { value: 50, label: "R$ 50,00" },
            { value: 20, label: "R$ 20,00" },
            { value: 10, label: "R$ 10,00" },
            { value: 5, label: "R$ 5,00" },
            { value: 2, label: "R$ 2,00" }
        ];

        const coins = [
            { value: 1.00, label: "R$ 1,00" },
            { value: 0.50, label: "R$ 0,50" },
            { value: 0.25, label: "R$ 0,25" },
            { value: 0.10, label: "R$ 0,10" },
            { value: 0.05, label: "R$ 0,05" }
        ];

        const banks = [
            "Banco do Brasil", "Caixa Econômica", "Bradesco", "Itaú", "Santander",
            "Nubank", "Inter", "PicPay", "Mercado Pago", "Outro"
        ];

        let checkCount = 0;
        let bankCount = 0;
        let moneyChart = null;

        function goBackToHome() {
            window.location.href = 'index.html';
        }

        function formatCurrency(value) {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

       function updateTotals() {
    let billsTotal = 0;
    let coinsTotal = 0;
    let checksTotal = 0;
    let banksTotal = 0;
    
    // Soma cédulas
    bills.forEach(bill => {
        const quantity = parseInt(document.getElementById(`bill-${bill.value}`).value) || 0;
        billsTotal += bill.value * quantity;
    });
    
    // Soma moedas
    coins.forEach(coin => {
        const quantity = parseInt(document.getElementById(`coin-${coin.value}`).value) || 0;
        coinsTotal += coin.value * quantity;
    });
    
    // Soma cheques - CORREÇÃO AQUI
    const checkInputs = document.querySelectorAll('[id^="check-value-"]');
    checkInputs.forEach(input => {
        if (input.value && input.value !== 'R$ 0,00') {
            // Remove formatação e converte para número
            let valueStr = input.value.replace('R$', '').replace(/\./g, '').replace(',', '.').trim();
            const value = parseFloat(valueStr) || 0;
            checksTotal += value;
        }
    });
    
    // Soma bancos - CORREÇÃO AQUI
    const bankInputs = document.querySelectorAll('[id^="bank-value-"]');
    bankInputs.forEach(input => {
        if (input.value && input.value !== 'R$ 0,00') {
            // Remove formatação e converte para número
            let valueStr = input.value.replace('R$', '').replace(/\./g, '').replace(',', '.').trim();
            const value = parseFloat(valueStr) || 0;
            banksTotal += value;
        }
    });
    
    const total = billsTotal + coinsTotal + checksTotal + banksTotal;
    
    console.log('Totais:', { billsTotal, coinsTotal, checksTotal, banksTotal, total }); // Para debug
    
    // Atualiza totais individuais
    document.getElementById('billsTotal').textContent = formatCurrency(billsTotal);
    document.getElementById('coinsTotal').textContent = formatCurrency(coinsTotal);
    document.getElementById('checksTotal').textContent = formatCurrency(checksTotal);
    document.getElementById('banksTotal').textContent = formatCurrency(banksTotal);
    
    // Atualiza resumo
    document.getElementById('summaryBills').textContent = formatCurrency(billsTotal);
    document.getElementById('summaryCoins').textContent = formatCurrency(coinsTotal);
    document.getElementById('summaryChecks').textContent = formatCurrency(checksTotal);
    document.getElementById('summaryBanks').textContent = formatCurrency(banksTotal);
    document.getElementById('totalDisplay').textContent = formatCurrency(total);
    
    // Atualiza gráfico
    updateChart(billsTotal, coinsTotal, checksTotal, banksTotal);
}

        function updateChart(bills, coins, checks, banks) {
            const ctx = document.getElementById('moneyChart').getContext('2d');
            
            if (moneyChart) {
                moneyChart.destroy();
            }
            
            const total = bills + coins + checks + banks;
            
            moneyChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Cédulas', 'Moedas', 'Cheques', 'Bancos'],
                    datasets: [{
                        data: [bills, coins, checks, banks],
                        backgroundColor: [
                            '#28a745', // Verde - Cédulas
                            '#ffc107', // Amarelo - Moedas
                            '#dc3545', // Vermelho - Cheques
                            '#17a2b8'  // Azul - Bancos
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                padding: 15
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                    return `${context.label}: ${formatCurrency(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function addCheck() {
            if (checkCount >= 5) {
                alert('Máximo de 5 cheques atingido!');
                return;
            }
            
            checkCount++;
            const checksContainer = document.getElementById('checksContainer');
            
            const checkHTML = `
                <div class="money-item" id="check-${checkCount}">
                    <div class="row g-2 align-items-center">
                        <div class="col-5">
                            <input type="text" class="form-control" placeholder="Nome do cheque" id="check-name-${checkCount}">
                        </div>
                        <div class="col-5">
                            <input type="text" class="form-control" placeholder="R$ 0,00" id="check-value-${checkCount}" oninput="formatCheckCurrency(this); updateTotals()">
                        </div>
                        <div class="col-2">
                            <button class="btn btn-danger btn-sm w-100" onclick="removeCheck(${checkCount})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            checksContainer.insertAdjacentHTML('beforeend', checkHTML);
            
            // Atualiza botão se atingiu o máximo
            if (checkCount >= 5) {
                document.getElementById('addCheckBtn').disabled = true;
            }
        }

        function addBank() {
            if (bankCount >= 5) {
                alert('Máximo de 5 bancos atingido!');
                return;
            }
            
            bankCount++;
            const banksContainer = document.getElementById('banksContainer');
            
            const bankOptions = banks.map(bank => 
                `<option value="${bank}">${bank}</option>`
            ).join('');
            
            const bankHTML = `
                <div class="money-item" id="bank-${bankCount}">
                    <div class="row g-2 align-items-center">
                        <div class="col-5">
                            <select class="form-select" id="bank-name-${bankCount}">
                                <option value="">Selecione o banco</option>
                                ${bankOptions}
                            </select>
                        </div>
                        <div class="col-5">
                            <input type="text" class="form-control" placeholder="R$ 0,00" id="bank-value-${bankCount}" oninput="formatBankCurrency(this); updateTotals()">
                        </div>
                        <div class="col-2">
                            <button class="btn btn-danger btn-sm w-100" onclick="removeBank(${bankCount})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            banksContainer.insertAdjacentHTML('beforeend', bankHTML);
            
            // Atualiza botão se atingiu o máximo
            if (bankCount >= 5) {
                document.getElementById('addBankBtn').disabled = true;
            }
        }

        function removeCheck(id) {
            const checkElement = document.getElementById(`check-${id}`);
            if (checkElement) {
                checkElement.remove();
                checkCount--;
                document.getElementById('addCheckBtn').disabled = false;
                updateTotals();
            }
        }

        function removeBank(id) {
            const bankElement = document.getElementById(`bank-${id}`);
            if (bankElement) {
                bankElement.remove();
                bankCount--;
                document.getElementById('addBankBtn').disabled = false;
                updateTotals();
            }
        }

        function formatCheckCurrency(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value === '') {
                input.value = '';
                return;
            }
            
            let number = parseInt(value) / 100;
            input.value = formatCurrency(number);
        }

        function formatBankCurrency(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value === '') {
                input.value = '';
                return;
            }
            
            let number = parseInt(value) / 100;
            input.value = formatCurrency(number);
        }

        function resetCalculator() {
            if (confirm('Zerar toda a contagem?')) {
                // Reseta cédulas
                bills.forEach(bill => {
                    document.getElementById(`bill-${bill.value}`).value = 0;
                });
                
                // Reseta moedas
                coins.forEach(coin => {
                    document.getElementById(`coin-${coin.value}`).value = 0;
                });
                
                // Remove todos os cheques
                const checksContainer = document.getElementById('checksContainer');
                checksContainer.innerHTML = '';
                checkCount = 0;
                document.getElementById('addCheckBtn').disabled = false;
                
                // Remove todos os bancos
                const banksContainer = document.getElementById('banksContainer');
                banksContainer.innerHTML = '';
                bankCount = 0;
                document.getElementById('addBankBtn').disabled = false;
                
                updateTotals();
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Gera cédulas
            const billsContainer = document.getElementById('billsContainer');
            bills.forEach(bill => {
                const div = document.createElement('div');
                div.className = 'money-item row align-items-center';
                div.innerHTML = `
                    <div class="col-6">${bill.label}</div>
                    <div class="col-6">
                        <input type="number" class="form-control" id="bill-${bill.value}" 
                               value="0" min="0" max="1000" oninput="updateTotals()">
                    </div>
                `;
                billsContainer.appendChild(div);
            });

            // Gera moedas
            const coinsContainer = document.getElementById('coinsContainer');
            coins.forEach(coin => {
                const div = document.createElement('div');
                div.className = 'money-item row align-items-center';
                div.innerHTML = `
                    <div class="col-6">${coin.label}</div>
                    <div class="col-6">
                        <input type="number" class="form-control" id="coin-${coin.value}" 
                               value="0" min="0" max="1000" oninput="updateTotals()">
                    </div>
                `;
                coinsContainer.appendChild(div);
            });

            // Adiciona primeiro cheque e banco automaticamente
            addCheck();
            addBank();
        });
    </script>
</body>
</html>