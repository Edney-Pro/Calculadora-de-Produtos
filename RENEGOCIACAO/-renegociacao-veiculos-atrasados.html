<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Renegociação - Veículos Atrasados - Encomenda Palotina</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #dc3545;
            --primary-dark: #c82333;
            --primary-light: #f8d7da;
            --secondary-color: #6c757d;
            --success: #28a745;
            --warning: #ffc107;
            --light-yellow: #fff3cd;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .calculator-container {
            width: 100%;
            min-height: 100vh;
            background: white;
            margin: 0;
            border-radius: 0;
        }
        
        .calculator-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 1.5rem 1rem;
            position: relative;
            text-align: center;
        }
        
        .btn-back-home {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 6px;
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }
        
        .btn-back-home:hover {
            background: rgba(255,255,255,0.3);
            color: white;
        }
        
        .debt-item {
            border-left: 4px solid var(--primary-color);
            background: var(--primary-light);
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 10px;
        }
        
        .installment-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--success);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        .entry-section {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
        }
        
        .summary-section {
            background: #e8f5e8;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
        }
        
        .footer-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            border-top: 2px solid #e9ecef;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .content-area {
            padding-bottom: 140px;
        }
        
        .conditions-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .phase-box {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid var(--primary-color);
        }
        
        .phase-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .value-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        /* SLIDERS PADRONIZADOS */
        .slider-container {
            padding: 0 1rem;
            position: relative;
        }
        
        .custom-slider {
            width: 100%;
            height: 6px;
            background: #dee2e6;
            border-radius: 3px;
            border: none;
            outline: none;
            margin: 20px 0;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-color);
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .custom-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-color);
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: -10px;
            font-size: 0.8rem;
            color: #666;
        }
        
        /* 🔧 RODAPÉ PADRONIZADO */
        .footer-btn {
            height: 50px;
            font-weight: 600;
            border-radius: 8px;
            border: 2px solid #000;
            font-size: 0.9rem;
        }
        
        .btn-home {
            background: #ff6b35;
            color: white;
        }
        
        .btn-new {
            background: #ffd166;
            color: #000;
        }
        
        .btn-summary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-whatsapp-footer {
            background: #e9ecef;
            color: #000;
            border: 2px solid #000;
            height: 50px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
        }
        
        .btn-whatsapp-footer.active {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            border: 2px solid #128C7E;
        }
        
        .interest-badge {
            background: #ffc107;
            color: #000;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .vehicle-icon {
            font-size: 1.2rem;
            margin-right: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .calculator-header {
                padding: 1rem;
            }
            
            .installment-display {
                font-size: 2rem;
            }
            
            .footer-btn {
                height: 45px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <!-- Header -->
        <div class="calculator-header">
            <button class="btn btn-back-home" onclick="goBackToHome()">
                <i class="bi bi-arrow-left me-1"></i>Voltar
            </button>
            <h1 style="font-size: 1.5rem; margin: 0;"><i class="bi bi-truck vehicle-icon"></i>Veículos Atrasados</h1>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; opacity: 0.9;">Renegocie suas dívidas de veículos em atraso</p>
        </div>

        <!-- Conteúdo Principal -->
        <div class="content-area">
            <div class="p-3">
                <!-- Dados do Cliente -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-person-badge me-2"></i>Seus Dados</h4>
                    <div class="row g-2">
                        <div class="col-12">
                            <input type="text" class="form-control" id="clientName" placeholder="Nome completo">
                        </div>
                        <div class="col-12">
                            <input type="text" class="form-control" id="clientCPF" placeholder="CPF (000.000.000-00)">
                        </div>
                    </div>
                </div>

                <!-- Condições Especiais -->
                <div class="conditions-box">
                    <h5 class="text-center mb-3"><i class="bi bi-info-circle me-2"></i>Condições para Veículos Atrasados</h5>
                    <div class="phase-box">
                        <div class="phase-title">📋 Condições Gerais</div>
                        <div>• Entrada obrigatória: <strong>50%</strong></div>
                        <div>• Parcela mínima: <strong>R$ 500,00</strong></div>
                    </div>
                    <div class="phase-box">
                        <div class="phase-title">🔄 1ª Fase - Parcelamento da Entrada</div>
                        <div>• Parcelamento da entrada de <strong>50%</strong></div>
                        <div>• Taxa: <strong>4% ao mês</strong></div>
                        <div>• Máximo: <strong>18 parcelas</strong></div>
                    </div>
                    <div class="phase-box">
                        <div class="phase-title">📈 2ª Fase - Parcelamento do Restante</div>
                        <div>• Parcelamento dos <strong>50%</strong> restantes</div>
                        <div>• Taxa: <strong>6.5% ao mês</strong></div>
                        <div>• Máximo: <strong>96 parcelas</strong></div>
                    </div>
                </div>

                <!-- Dívidas -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-receipt me-2"></i>Valor Total das Dívidas</h4>
                    <div id="debtsContainer">
                        <!-- Dívidas serão adicionadas aqui -->
                    </div>
                    <button class="btn btn-outline-primary w-100 mt-2" onclick="addDebt()">
                        <i class="bi bi-plus-circle me-1"></i>Adicionar Valor
                    </button>
                </div>

                <!-- Valores Calculados -->
                <div class="entry-section">
                    <h4 class="section-title"><i class="bi bi-calculator me-2"></i>Valores Calculados</h4>
                    <div class="row text-center mb-3">
                        <div class="col-6">
                            <div class="value-display" id="entryValueDisplay">R$ 0,00</div>
                            <small>Entrada (50%)</small>
                        </div>
                        <div class="col-6">
                            <div class="value-display" id="remainingValueDisplay">R$ 0,00</div>
                            <small>Valor Restante (50%)</small>
                        </div>
                    </div>
                </div>

                <!-- Parcelas 1ª Fase - ENTRADA (MÁXIMO 18x) -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-calendar-range me-2"></i>1ª Fase - Parcelamento da Entrada</h4>
                    <div class="slider-container">
                        <input type="range" class="custom-slider" id="firstPhaseRange" min="1" max="18" value="1">
                        <div class="slider-labels">
                            <span>1x</span>
                            <span>18x</span>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <div class="installment-display" id="firstPhaseDisplay">R$ 0,00</div>
                        <small class="text-muted fw-semibold">
                            <span id="firstPhaseValue">1</span> parcela • 
                            <span class="interest-badge">4% a.m.</span>
                        </small>
                    </div>
                </div>

                <!-- Parcelas 2ª Fase - VALOR RESTANTE (MÁXIMO 96x) -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-calendar-range me-2"></i>2ª Fase - Parcelamento do Restante</h4>
                    <div class="slider-container">
                        <input type="range" class="custom-slider" id="secondPhaseRange" min="1" max="96" value="1">
                        <div class="slider-labels">
                            <span>1x</span>
                            <span>96x</span>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <div class="installment-display" id="secondPhaseDisplay">R$ 0,00</div>
                        <small class="text-muted fw-semibold">
                            <span id="secondPhaseValue">1</span> parcela • 
                            <span class="interest-badge">6.5% a.m.</span>
                        </small>
                    </div>
                </div>

                <!-- Resumo (inicialmente escondido) -->
                <div class="summary-section hidden" id="summarySection">
                    <h5 class="text-center mb-3"><i class="bi bi-file-text me-2"></i>Resumo da Renegociação</h5>
                    <div id="summaryContent">
                        <!-- Conteúdo do resumo será gerado aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 🔧 RODAPÉ PADRONIZADO -->
        <div class="footer-actions">
            <div class="row g-2">
                <div class="col-4">
                    <button class="btn btn-home footer-btn w-100" onclick="goBackToHome()">
                        <i class="bi bi-house me-1"></i>Home
                    </button>
                </div>
                <div class="col-4">
                    <button class="btn btn-new footer-btn w-100" onclick="resetCalculator()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Nova
                    </button>
                </div>
                <div class="col-4">
                    <button class="btn btn-summary footer-btn w-100" onclick="showSummary()">
                        <i class="bi bi-eye me-1"></i>Ver Resumo
                    </button>
                </div>
                <div class="col-12 mt-2">
                    <button class="btn btn-whatsapp-footer" id="whatsappFooterBtn" onclick="sendWhatsApp()">
                        <i class="bi bi-whatsapp me-1"></i>Enviar WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variáveis globais
        let debtCount = 0;

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            addDebt();
            updateCalculations();
            setupEventListeners();
        });

        // Configura event listeners
        function setupEventListeners() {
            document.getElementById('firstPhaseRange').addEventListener('input', updateCalculations);
            document.getElementById('secondPhaseRange').addEventListener('input', updateCalculations);
        }

        // 🔧 FUNÇÃO VOLTAR PARA HOME PADRONIZADA
        function goBackToHome() {
            window.location.href = '../index.html';
        }

        // Adicionar dívida (APENAS VALOR - SEM DESCRIÇÃO)
        function addDebt() {
            if (debtCount >= 10) {
                alert('Máximo de 10 valores atingido!');
                return;
            }

            debtCount++;
            const debtId = `debt-${debtCount}`;
            
            const debtHTML = `
                <div class="debt-item" id="${debtId}">
                    <div class="row g-2 align-items-center">
                        <div class="col-12">
                            <input type="text" class="form-control debt-value" placeholder="R$ 0,00" oninput="formatCurrency(this); updateCalculations()">
                        </div>
                        <div class="col-12 text-end mt-1">
                            ${debtCount > 1 ? 
                                `<button class="btn btn-danger btn-sm" onclick="removeDebt('${debtId}')">
                                    <i class="bi bi-trash"></i> Remover
                                </button>` : 
                                ''
                            }
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('debtsContainer').insertAdjacentHTML('beforeend', debtHTML);
            updateCalculations();
        }

        // Remover dívida
        function removeDebt(debtId) {
            const debtElement = document.getElementById(debtId);
            if (debtElement) {
                debtElement.remove();
                debtCount--;
                updateCalculations();
            }
        }

        // Formatação de moeda
        function formatCurrency(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value === '') {
                input.value = '';
                return;
            }
            
            let number = parseInt(value) / 100;
            input.value = formatCurrencyValue(number);
        }

        // Formata valor para moeda
        function formatCurrencyValue(value) {
            return value.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
        }

        // Obtém valor numérico do campo de moeda
        function getCurrencyValue(currencyString) {
            if (!currencyString) return 0;
            let value = currencyString.replace('R$', '')
                                    .replace(/\./g, '')
                                    .replace(',', '.')
                                    .trim();
            return parseFloat(value) || 0;
        }

        // Calcula total das dívidas
        function calculateTotalDebts() {
            let total = 0;
            const debtElements = document.querySelectorAll('.debt-item');
            
            debtElements.forEach(debtElement => {
                const valueInput = debtElement.querySelector('.debt-value');
                const value = getCurrencyValue(valueInput.value);
                total += value;
            });
            
            return total;
        }

        // Cálculo do valor da parcela com juros
        function calculateInstallment(totalValue, installments, interestRate) {
            if (installments === 1) return totalValue;
            if (installments === 0) return 0;
            
            const numerator = interestRate * Math.pow(1 + interestRate, installments);
            const denominator = Math.pow(1 + interestRate, installments) - 1;
            
            return totalValue * (numerator / denominator);
        }

        // Função para calcular datas CORRIGIDA
        function calculateDates(firstPhaseInstallments, secondPhaseInstallments) {
            const today = new Date();
            
            // 1ª FASE - Entrada
            const firstPaymentPhase1 = new Date(today);
            firstPaymentPhase1.setMonth(firstPaymentPhase1.getMonth() + 1);
            
            const lastPaymentPhase1 = new Date(firstPaymentPhase1);
            lastPaymentPhase1.setMonth(lastPaymentPhase1.getMonth() + firstPhaseInstallments - 1);
            
            // 2ª FASE - Restante (INICIA APÓS término da 1ª fase)
            const firstPaymentPhase2 = new Date(lastPaymentPhase1);
            firstPaymentPhase2.setMonth(firstPaymentPhase2.getMonth() + 1);
            
            const lastPaymentPhase2 = new Date(firstPaymentPhase2);
            lastPaymentPhase2.setMonth(lastPaymentPhase2.getMonth() + secondPhaseInstallments - 1);
            
            return {
                firstPaymentPhase1: firstPaymentPhase1,
                lastPaymentPhase1: lastPaymentPhase1,
                firstPaymentPhase2: firstPaymentPhase2,
                lastPaymentPhase2: lastPaymentPhase2
            };
        }

        // Atualiza todos os cálculos
        function updateCalculations() {
            const totalDebts = calculateTotalDebts();
            const firstPhaseInstallments = parseInt(document.getElementById('firstPhaseRange').value);
            const secondPhaseInstallments = parseInt(document.getElementById('secondPhaseRange').value);
            
            // Atualiza valores dos sliders
            document.getElementById('firstPhaseValue').textContent = firstPhaseInstallments;
            document.getElementById('secondPhaseValue').textContent = secondPhaseInstallments;
            
            // Calcula valores fixos (50% entrada, 50% restante)
            const entryValue = totalDebts * 0.50; // 50% entrada
            const remainingValue = totalDebts * 0.50; // 50% restante
            
            // Atualiza displays dos valores
            document.getElementById('entryValueDisplay').textContent = formatCurrencyValue(entryValue);
            document.getElementById('remainingValueDisplay').textContent = formatCurrencyValue(remainingValue);
            
            // 1ª FASE: Parcelamento da ENTRADA (4% a.m.)
            let firstPhaseValue = 0;
            if (entryValue > 0 && firstPhaseInstallments > 0) {
                firstPhaseValue = calculateInstallment(entryValue, firstPhaseInstallments, 0.04); // 4% a.m.
            }
            document.getElementById('firstPhaseDisplay').textContent = formatCurrencyValue(firstPhaseValue);
            
            // 2ª FASE: Parcelamento do RESTANTE (6.5% a.m.)
            let secondPhaseValue = 0;
            if (remainingValue > 0 && secondPhaseInstallments > 0) {
                secondPhaseValue = calculateInstallment(remainingValue, secondPhaseInstallments, 0.065); // 6.5% a.m.
            }
            document.getElementById('secondPhaseDisplay').textContent = formatCurrencyValue(secondPhaseValue);
        }

        // Mostrar resumo CORRIGIDO
        function showSummary() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientCPF = document.getElementById('clientCPF').value.trim();
            const totalDebts = calculateTotalDebts();
            
            // Validações
            if (!clientName) {
                alert('Por favor, informe seu nome.');
                return;
            }
            
            if (!clientCPF || clientCPF.replace(/\D/g, '').length !== 11) {
                alert('Por favor, informe um CPF válido.');
                return;
            }
            
            if (totalDebts === 0) {
                alert('Por favor, adicione pelo menos um valor.');
                return;
            }
            
            const firstPhaseInstallments = parseInt(document.getElementById('firstPhaseRange').value);
            const secondPhaseInstallments = parseInt(document.getElementById('secondPhaseRange').value);
            const firstPhaseValue = getCurrencyValue(document.getElementById('firstPhaseDisplay').textContent);
            const secondPhaseValue = getCurrencyValue(document.getElementById('secondPhaseDisplay').textContent);
            const entryValue = totalDebts * 0.50;
            const remainingValue = totalDebts * 0.50;
            
            // Calcula datas CORRETAS
            const dates = calculateDates(firstPhaseInstallments, secondPhaseInstallments);
            const today = new Date();
            
            // Monta resumo CORRETO - PARCELAS NÃO SOMAM
            const summaryHTML = `
                <div class="mb-3">
                    <strong>Data da Proposta:</strong> ${today.toLocaleDateString('pt-BR')}
                </div>
                <div class="mb-3">
                    <strong>Cliente:</strong> ${clientName}<br>
                    <strong>CPF:</strong> ${clientCPF}
                </div>
                <div class="mb-3">
                    <strong>Valor Total Renegociado:</strong><br>
                    <div class="d-flex justify-content-between fw-bold fs-5">
                        <span>Total:</span>
                        <span>${formatCurrencyValue(totalDebts)}</span>
                    </div>
                </div>
                
                <div class="mb-3 p-3 bg-light rounded">
                    <strong>🔄 1ª FASE - ENTRADA</strong><br>
                    <div class="fw-bold">${firstPhaseInstallments}x de ${formatCurrencyValue(firstPhaseValue)}</div>
                    <small class="text-muted">
                        Início: ${dates.firstPaymentPhase1.toLocaleDateString('pt-BR')}<br>
                        Término: ${dates.lastPaymentPhase1.toLocaleDateString('pt-BR')}<br>
                        <em>Taxa: 4% ao mês</em>
                    </small>
                </div>
                
                <div class="mb-3 p-3 bg-light rounded">
                    <strong>📈 2ª FASE - VALOR RESTANTE</strong><br>
                    <div class="fw-bold">${secondPhaseInstallments}x de ${formatCurrencyValue(secondPhaseValue)}</div>
                    <small class="text-muted">
                        Início: ${dates.firstPaymentPhase2.toLocaleDateString('pt-BR')}<br>
                        Término: ${dates.lastPaymentPhase2.toLocaleDateString('pt-BR')}<br>
                        <em>Taxa: 6.5% ao mês</em>
                    </small>
                </div>
                
                <div class="mb-3">
                    <strong>Resumo do Pagamento:</strong><br>
                    • Primeiros ${firstPhaseInstallments} meses: ${formatCurrencyValue(firstPhaseValue)}<br>
                    • Próximos ${secondPhaseInstallments} meses: ${formatCurrencyValue(secondPhaseValue)}<br>
                    • Total de meses: <strong>${firstPhaseInstallments + secondPhaseInstallments} meses</strong>
                </div>
            `;
            
            document.getElementById('summaryContent').innerHTML = summaryHTML;
            document.getElementById('summarySection').classList.remove('hidden');
            
            // 🔧 ATIVA BOTÃO WHATSAPP
            document.getElementById('whatsappFooterBtn').classList.add('active');
            
            // Scroll para o resumo
            document.getElementById('summarySection').scrollIntoView({ behavior: 'smooth' });
        }

        // Enviar para WhatsApp CORRIGIDO
        function sendWhatsApp() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientCPF = document.getElementById('clientCPF').value.trim();
            const totalDebts = calculateTotalDebts();
            const firstPhaseInstallments = parseInt(document.getElementById('firstPhaseRange').value);
            const secondPhaseInstallments = parseInt(document.getElementById('secondPhaseRange').value);
            const firstPhaseValue = getCurrencyValue(document.getElementById('firstPhaseDisplay').textContent);
            const secondPhaseValue = getCurrencyValue(document.getElementById('secondPhaseDisplay').textContent);
            
            // Calcula datas CORRETAS
            const dates = calculateDates(firstPhaseInstallments, secondPhaseInstallments);
            const today = new Date();
            
            const message = `*🚗 PROPOSTA - RENEGOCIAÇÃO VEÍCULOS ATRASADOS*\n\n` +
                           `*Data:* ${today.toLocaleDateString('pt-BR')}\n` +
                           `*Cliente:* ${clientName}\n` +
                           `*CPF:* ${clientCPF}\n\n` +
                           `*VALOR TOTAL RENEGOCIADO: ${formatCurrencyValue(totalDebts)}*\n\n` +
                           `*🔄 1ª FASE - ENTRADA (${firstPhaseInstallments}x)*\n` +
                           `Parcela: ${formatCurrencyValue(firstPhaseValue)}\n` +
                           `Início: ${dates.firstPaymentPhase1.toLocaleDateString('pt-BR')}\n` +
                           `Término: ${dates.lastPaymentPhase1.toLocaleDateString('pt-BR')}\n` +
                           `*Taxa: 4% ao mês*\n\n` +
                           `*📈 2ª FASE - VALOR RESTANTE (${secondPhaseInstallments}x)*\n` +
                           `Parcela: ${formatCurrencyValue(secondPhaseValue)}\n` +
                           `Início: ${dates.firstPaymentPhase2.toLocaleDateString('pt-BR')}\n` +
                           `Término: ${dates.lastPaymentPhase2.toLocaleDateString('pt-BR')}\n` +
                           `*Taxa: 6.5% ao mês*\n\n` +
                           `*RESUMO DO PAGAMENTO:*\n` +
                           `• Primeiros ${firstPhaseInstallments} meses: ${formatCurrencyValue(firstPhaseValue)}\n` +
                           `• Próximos ${secondPhaseInstallments} meses: ${formatCurrencyValue(secondPhaseValue)}\n` +
                           `• Total: ${firstPhaseInstallments + secondPhaseInstallments} meses\n\n` +
                           `_*Proposta sujeita à análise e aprovação*_\n` +
                           `📞 *Encomenda Palotina*\n` +
                           `💚 https://wa.me/554498408460`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/554498408460?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // Reset da calculadora
        function resetCalculator() {
            if (confirm('Deseja começar uma nova simulação?')) {
                document.getElementById('clientName').value = '';
                document.getElementById('clientCPF').value = '';
                document.getElementById('firstPhaseRange').value = 1;
                document.getElementById('secondPhaseRange').value = 1;
                document.getElementById('summarySection').classList.add('hidden');
                
                // 🔧 DESATIVA BOTÃO WHATSAPP
                document.getElementById('whatsappFooterBtn').classList.remove('active');
                
                // Remove todas as dívidas exceto a primeira
                const debtsContainer = document.getElementById('debtsContainer');
                const firstDebt = debtsContainer.querySelector('.debt-item');
                
                debtsContainer.innerHTML = '';
                if (firstDebt) {
                    debtsContainer.appendChild(firstDebt);
                    firstDebt.querySelector('.debt-value').value = '';
                }
                
                debtCount = 1;
                updateCalculations();
            }
        }

        // Formatação automática do CPF
        document.getElementById('clientCPF').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            if (value.length > 3) value = value.replace(/^(\d{3})(\d)/, '$1.$2');
            if (value.length > 6) value = value.replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3');
            if (value.length > 9) value = value.replace(/^(\d{3})\.(\d{3})\.(\d{3})(\d)/, '$1.$2.$3-$4');
            e.target.value = value;
        });
    </script>
</body>
</html>