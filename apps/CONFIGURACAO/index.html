<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Configura√ß√µes</title>
    
    <!-- GLOBAIS (Tema, Componentes, e Estilos Gerais) -->
    <link rel="stylesheet" href="../../global/theme.css">
    <link rel="stylesheet" href="../../global/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* ESTILOS ESSENCIAIS PARA CONTROLAR O SCROLL E O POSICIONAMENTO */
        body {
            display: flex;
            flex-direction: column;
            height: 100vh; /* Ocupa a tela inteira */
            overflow: hidden; /* O BODY N√ÉO ROLA */
        }
        
        /* Onde o Header Global ser√° injetado */
        #global-header {
            flex-shrink: 0;
        }
        
        .config-body-wrapper {
            display: flex;
            flex-direction: column;
            flex: 1; /* Ocupa o espa√ßo restante */
            overflow: hidden;
        }
        
        /* O conte√∫do das abas deve rolar */
        .tab-content {
            flex: 1;
            overflow-y: auto; /* Rola apenas o conte√∫do */
            padding: 1rem;
            padding-bottom: 80px; /* Espa√ßo para o FAB */
        }

        /* O Footer Global (injetado) ficar√° no final do body, mas o FAB precisa de espa√ßo */
        .save-fab {
            position: fixed;
            bottom: 85px; /* Ajustado para ficar acima do Footer Global (que tem 80px de altura) */
            right: 1rem;
            z-index: 1000;
            transition: all 0.3s ease; /* Adicionado para efeito suave de feedback */
        }

        /* O canvas do Matrix Background fica fixo, por baixo de tudo */
        #matrixBackground {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: -1; 
        }

       /* Estilos para as demos de fonte e peso */
.font-demo, .weight-demo {
    margin-top: 8px;
    padding: 8px;
    background: var(--card-bg); /* Use vari√°veis de tema */
    border: 1px solid var(--border-color); /* Use vari√°veis de tema */
    border-radius: 8px;
    font-size: 0.9em;
    color: var(--text-color); /* Use vari√°veis de tema */
    min-height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    transition: all 0.3s ease;
}

       /* Estilos do Matrix Preview */
.matrix-viewer {
    width: 100%;
    aspect-ratio: 16 / 9; /* Mant√©m propor√ß√£o de v√≠deo */
    background-color: #000; /* Fundo escuro para o preview */
    border-radius: 8px;
    overflow: hidden;
    position: relative;
    margin-bottom: 1rem;
    display: flex;
    justify-content: center;
    align-items: center;
    border: 1px solid var(--border-color);
}

       #matrixPreview {
    width: 100%;
    height: 100%;
    display: block;
    opacity: 0.25; /* Opacidade inicial para o preview, ajust√°vel via JS */
}

.viewer-controls {
    position: absolute;
    bottom: 8px;
    left: 8px;
    right: 8px;
    display: flex;
    gap: 8px;
    justify-content: center;
}

.viewer-controls .btn-small {
    padding: 6px 12px;
    font-size: 0.85rem;
    min-width: 80px;
}

/* Ajuste o save-fab para ter transi√ß√£o para feedback visual */
.save-fab {
    position: fixed;
    bottom: 85px; /* Ajustado para ficar acima do Footer Global (que tem 80px de altura) */
    right: 1rem;
    z-index: 1000;
    transition: all 0.3s ease; /* Adicionado para efeito suave de feedback */
}
    </style>
</head>
<body>

    <!-- SHELL HEADER GLOBAL (Injetado pelo header-footer.js) -->
    <div id="global-header"></div> 

    <div class="config-body-wrapper">
        <!-- ABAS DE NAVEGA√á√ÉO (Local, pois o Header Global n√£o as conhece) -->
        <nav class="tabs-nav">
            <button class="tab-btn active" data-tab="appearance">
                <i class="fas fa-palette"></i>
                <span>Apar√™ncia</span>
            </button>
            <button class="tab-btn" data-tab="matrix">
                <i class="fas fa-matrix"></i>
                <span>Matrix</span>
            </button>
            <button class="tab-btn" data-tab="icons">
                <i class="fas fa-icons"></i>
                <span>√çcones</span>
            </button>
            <button class="tab-btn" data-tab="admin">
                <i class="fas fa-shield-alt"></i>
                <span>Admin</span>
            </button>
        </nav>

        <!-- CONTE√öDO DAS ABAS -->
        <main class="tab-content">
            <!-- ABA APAR√äNCIA -->
            <section id="appearance" class="tab-pane active">
                <div class="card">
                    <h2><i class="fas fa-palette"></i> Apar√™ncia do Sistema</h2>
                    
                    <div class="setting-group">
                        <label for="theme">Tema do Sistema</label>
                        <select id="theme">
                            <option value="light">üåû Claro</option>
                            <option value="dark">üåô Escuro</option>
                            <option value="gold">‚≠ê Dourado</option>
                            <option value="blue">üîµ Azul</option>
                            <option value="purple">üü£ Lil√°s</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label for="font">Fonte do Sistema</label>
                        <select id="font">
                            <option value="Inter">Inter</option>
                            <option value="Roboto">Roboto</option>
                            <option value="Poppins">Poppins</option>
                            <option value="Open Sans">Open Sans</option>
                            <option value="Montserrat">Montserrat</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label for="fontWeight">Peso da Fonte</label>
                        <select id="fontWeight">
                            <option value="300">Leve</option>
                            <option value="400">Regular</option>
                            <option value="500">M√©dio</option>
                            <option value="600">Semi-negrito</option>
                            <option value="700">Negrito</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- ABA MATRIX -->
            <section id="matrix" class="tab-pane">
                <div class="card">
                    <h2><i class="fas fa-matrix"></i> Efeito Matrix</h2>
                    
                    <!-- VISOR DO MATRIX -->
                    <div class="matrix-viewer" id="matrixViewer">
                        <canvas id="matrixPreview"></canvas>
                        <div class="viewer-controls">
                            <button onclick="MatrixViewer.toggle()" class="btn-small">
                                <i class="fas fa-play" id="playIcon"></i>
                                <span id="playText">Iniciar</span>
                            </button>
                            <button onclick="MatrixViewer.reset()" class="btn-small">
                                <i class="fas fa-sync"></i>
                                Reiniciar
                            </button>
                        </div>
                    </div>

                    <div class="setting-group">
                        <label for="matrixMode">Modo do Efeito</label>
                        <select id="matrixMode">
                            <option value="off">üö´ Desligado</option>
                            <option value="smooth">üí® Suave</option>
                            <option value="dynamic">‚ö° Din√¢mico</option>
                            <option value="realistic">üéØ Realista</option>
                            <option value="minimal">üåÄ Minimalista</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label for="matrixOpacity">
                            Opacidade: <span id="opacityValue" class="range-value">25%</span>
                        </label>
                        <input id="matrixOpacity" type="range" min="0.05" max="0.6" step="0.05" value="0.25">
                    </div>

                    <div class="setting-group">
                        <label for="matrixColor">Cor do Efeito</label>
                        <input id="matrixColor" type="color" value="#00ff66">
                    </div>

                    <!-- CONFIGURA√á√ïES AVAN√áADAS -->
                    <div class="advanced-settings">
                        <h3><i class="fas fa-sliders-h"></i> Configura√ß√µes Avan√ßadas</h3>
                        
                        <div class="setting-group">
                            <label for="matrixSpeed">
                                Velocidade: <span id="speedValue" class="range-value">5</span>
                            </label>
                            <input id="matrixSpeed" type="range" min="1" max="10" step="1" value="5">
                        </div>

                        <div class="setting-group">
                            <label for="matrixStreams">
                                Listas: <span id="streamsValue" class="range-value">8</span>
                            </label>
                            <input id="matrixStreams" type="range" min="5" max="20" step="1" value="8">
                        </div>

                        <div class="setting-group">
                            <label for="matrixDirection">Dire√ß√£o</label>
                            <select id="matrixDirection">
                                <option value="up">‚¨ÜÔ∏è Subindo</option>
                                <option value="down">‚¨áÔ∏è Descendo</option>
                                <option value="random">üé≤ Aleat√≥ria</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ABA √çCONES -->
            <section id="icons" class="tab-pane">
                <div class="card">
                    <h2><i class="fas fa-icons"></i> √çcones e Interface</h2>
                    
                    <div class="setting-group">
                        <label for="iconStyle">Estilo dos √çcones</label>
                        <select id="iconStyle">
                            <option value="classic">üé® Cl√°ssico</option>
                            <option value="modern">‚ö° Moderno</option>
                            <option value="premium">üíé Premium</option>
                            <option value="neon">üîÆ Neon</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label for="animationSpeed">Velocidade das Anima√ß√µes</label>
                        <select id="animationSpeed">
                            <option value="slow">üê¢ Lenta</option>
                            <option value="normal">üö∂ Normal</option>
                            <option value="fast">‚ö° R√°pida</option>
                        </select>
                    </div>

                    <!-- PREVIEW DE √çCONES -->
                    <div class="icons-preview">
                        <h3>Preview dos √çcones</h3>
                        <div class="icons-grid">
                            <div class="icon-preview"><i class="fas fa-home"></i><span>Home</span></div>
                            <div class="icon-preview"><i class="fas fa-calculator"></i><span>Calc</span></div>
                            <div class="icon-preview"><i class="fas fa-chart-pie"></i><span>Gr√°ficos</span></div>
                            <div class="icon-preview"><i class="fas fa-cogs"></i><span>Config</span></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ABA ADMIN -->
            <section id="admin" class="tab-pane">
                <div class="card admin-section">
                    <h2><i class="fas fa-shield-alt"></i> Acesso Administrativo</h2>
                    
                    <div class="setting-group">
                        <label for="adminPassword">Senha de Administrador</label>
                        <div class="password-input">
                            <input type="password" id="adminPassword" placeholder="Digite a senha PIM">
                            <button class="toggle-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <button class="btn-admin">
                            <i class="fas fa-unlock"></i> Acessar Taxas
                        </button>
                    </div>

                    <div class="admin-actions">
                        <button class="btn-danger">
                            <i class="fas fa-undo"></i> Restaurar Padr√µes
                        </button>
                        <button class="btn-secondary" id="exportSettingsBtn">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                        <button class="btn-secondary" id="importSettingsBtn">
                            <i class="fas fa-upload"></i> Importar
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- BOT√ÉO SALVAR FIXO -->
        <div class="save-fab">
            <button class="fab-btn">
                <i class="fas fa-save"></i>
                <span>Salvar</span>
            </button>
        </div>
    </div>

    <!-- CANVAS DO MATRIX BACKGROUND GLOBAL (SEMPRE NO FINAL DO BODY) -->
    <canvas id="matrixBackground" class="matrix-bg"></canvas>

    <!-- SCRIPTS GLOBAIS E LOCAIS - ORDEM CR√çTICA -->
    <script src="../../global/config-manager.js"></script> <!-- Primeiro, para ConfigManager ser global -->
    <script src="../../global/header-footer.js"></script>
    <script src="../../global/matrix-background.js"></script> <!-- MatrixBackground global -->
    <script src="script.js"></script> <!-- Seu script.js com SettingsManager e MatrixViewer -->
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 1. O ConfigManager global j√° est√° carregado e deve iniciar suas pr√≥prias configs.
            if (window.ConfigManager) {
                ConfigManager.loadConfig(); // Carrega configs do localStorage
                ConfigManager.applyAllSettings(); // Aplica tema, fonte, e inicia o MatrixBackground
            }

            // 2. Carrega o Header/Footer global com o t√≠tulo "Configura√ß√µes"
            loadGlobalHeaderFooter("Configura√ß√µes"); 
            
            // 3. Inicializa o SettingsManager da p√°gina, que cuidar√° da UI e do MatrixViewer (preview)
            SettingsManager.init(); 
        });
    </script>
</body>
</html>