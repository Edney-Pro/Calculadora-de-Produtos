<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cadastro de Cliente - Sistema de Parcelas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header class="standard-header">
        <div class="container">
            <div class="header-content">
                <div class="logo"><i id="header-icon" class="fas fa-user-plus logo-icon"></i><h1 id="header-title">Dados Pessoais</h1></div>
                <p id="header-tagline" class="tagline">Seus dados de identifica√ß√£o.</p>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <form id="multiStepForm" onsubmit="event.preventDefault();">
                <!-- ETAPA 1: DADOS PESSOAIS -->
                <div id="step-1" class="form-step active">
                    <div class="form-group"><label for="fullName">Nome Completo <span class="required">*</span></label><input type="text" id="fullName" class="form-control" required minlength="3"></div>
                    <div class="form-group"><label for="cpf">CPF <span class="required">*</span></label><input type="text" id="cpf" class="form-control" placeholder="000.000.000-00" required></div>
                    <div class="form-group"><label for="rg">RG <span class="required">*</span></label><input type="text" id="rg" class="form-control" placeholder="00.000.000-0" required></div>
                    <div class="form-group"><label for="birthDate">Data de Nascimento <span class="required">*</span></label><input type="date" id="birthDate" class="form-control" required></div>
                    <div class="form-group"><label for="phone">Telefone Principal <span class="required">*</span></label><input type="text" id="phone" class="form-control" placeholder="(00) 00000-0000" required></div>
                    <div class="form-group"><label for="email">E-mail <span class="required">*</span></label><input type="email" id="email" class="form-control" placeholder="seu.email@exemplo.com" required></div>
                </div>

                <!-- ETAPA 2: ENDERE√áO -->
                <div id="step-2" class="form-step">
                    <div class="form-group"><label for="cep">CEP <span class="required">*</span></label><input type="text" id="cep" class="form-control" placeholder="00000-000" required></div>
                    <div class="form-group"><label for="street">Rua <span class="required">*</span></label><input type="text" id="street" class="form-control" required></div>
                    <div class="form-group"><label for="number">N√∫mero <span class="required">*</span></label><input type="text" id="number" class="form-control" required></div>
                    <div class="form-group"><label for="neighborhood">Bairro <span class="required">*</span></label><input type="text" id="neighborhood" class="form-control" required></div>
                    <div class="form-group"><label for="city">Cidade</label><input type="text" id="city" class="form-control" readonly></div>
                    <div class="form-group"><label for="state">Estado (UF)</label><input type="text" id="state" class="form-control" readonly></div>
                    <div class="form-group"><label for="residenceTime">Tempo de Moradia <span class="required">*</span></label><select id="residenceTime" class="form-control" required><option value="">Selecione...</option><option value="Menos de 1 ano">Menos de 1 ano</option><option value="1 a 3 anos">1 a 3 anos</option><option value="3 a 5 anos">3 a 5 anos</option><option value="5 a 10 anos">5 a 10 anos</option><option value="Mais de 10 anos">Mais de 10 anos</option></select></div>
                </div>

                <!-- ETAPA 3: COMO NOS CONHECEU -->
                <div id="step-3" class="form-step">
                    <div class="form-group">
                        <label>Como nos conheceu? <span class="required">*</span></label>
                        <div class="radio-group-wrapper full-width">
                            <div><input type="radio" id="met1" name="howMet" value="Indica√ß√£o" required checked><label for="met1">Indica√ß√£o</label></div>
                            <div><input type="radio" id="met2" name="howMet" value="Instagram"><label for="met2">Instagram</label></div>
                            <div><input type="radio" id="met3" name="howMet" value="Facebook"><label for="met3">Facebook</label></div>
                            <div><input type="radio" id="met4" name="howMet" value="TikTok"><label for="met4">TikTok</label></div>
                            <div><input type="radio" id="met5" name="howMet" value="Google"><label for="met5">Google</label></div>
                            <div><input type="radio" id="met6" name="howMet" value="WhatsApp"><label for="met6">WhatsApp</label></div>
                            <div><input type="radio" id="met7" name="howMet" value="Outro"><label for="met7">Outro</label></div>
                        </div>
                    </div>
                    <div id="referrerField" style="display: none;"><div class="form-group"><label for="referrerName">Quem indicou? <span class="required">*</span></label><input type="text" id="referrerName" class="form-control" required></div></div>
                </div>
                
                <!-- ETAPA 4: DADOS FINANCEIROS -->
                <div id="step-4" class="form-step">
                    <div class="form-group">
                        <label>Faixa Salarial <span class="required">*</span></label>
                        <div class="radio-group-wrapper full-width">
                            <div><input type="radio" id="sal1" name="salaryRange" value="De R$ 800 a R$ 1.500" required><label for="sal1">De R$ 800 a R$ 1.500</label></div>
                            <div><input type="radio" id="sal2" name="salaryRange" value="De R$ 1.501 a R$ 2.500"><label for="sal2">De R$ 1.501 a R$ 2.500</label></div>
                            <div><input type="radio" id="sal3" name="salaryRange" value="De R$ 2.501 a R$ 3.500"><label for="sal3">De R$ 2.501 a R$ 3.500</label></div>
                            <div><input type="radio" id="sal4" name="salaryRange" value="De R$ 3.501 a R$ 4.500"><label for="sal4">De R$ 3.501 a R$ 4.500</label></div>
                            <div><input type="radio" id="sal5" name="salaryRange" value="Acima de R$ 4.500"><label for="sal5">Acima de R$ 4.500</label></div>
                        </div>
                    </div>
                </div>

                <!-- ETAPA 5: REFER√äNCIAS -->
                <div id="step-5" class="form-step">
                    <div class="form-group"><label for="profRefName">Refer√™ncia Profissional <span class="required">*</span></label><input type="text" id="profRefName" class="form-control" required></div>
                    <div class="form-group"><label for="profRefPhone">Telefone da Ref. Profissional <span class="required">*</span></label><input type="text" id="profRefPhone" class="form-control" placeholder="(00) 00000-0000" required></div>
                    <div class="form-group"><label for="personalRefName">Refer√™ncia Pessoal (Opcional)</label><input type="text" id="personalRefName" class="form-control"></div>
                    <div class="form-group"><label for="personalRefPhone">Telefone da Ref. Pessoal (Opcional)</label><input type="text" id="personalRefPhone" class="form-control" placeholder="(00) 00000-0000"></div>
                </div>

                <!-- ETAPA 6: REDES SOCIAIS -->
                <div id="step-6" class="form-step">
                    <div class="form-group"><label for="social1">Instagram (Link ou @usu√°rio) <span class="required">*</span></label><input type="text" id="social1" class="form-control" placeholder="@usuario ou https://instagram.com/..." required></div>
                    <div class="form-group"><label for="social2">Facebook (Opcional)</label><input type="text" id="social2" class="form-control"></div>
                    <div class="form-group"><label for="social3">TikTok (Opcional)</label><input type="text" id="social3" class="form-control"></div>
                    <div class="form-group"><label for="social4">LinkedIn (Opcional)</label><input type="text" id="social4" class="form-control"></div>
                    <div class="form-group"><label for="social5">X / Twitter (Opcional)</label><input type="text" id="social5" class="form-control"></div>
                    <div class="form-group"><label for="social6">Outra Rede (Opcional)</label><input type="text" id="social6" class="form-control"></div>
                </div>

                <!-- ETAPA 7: RESUMO -->
                <div id="step-7" class="form-step"><div id="summary-content"></div></div>

                <!-- ETAPA 8: AVISO FINAL -->
                <div id="step-8" class="form-step">
                    <div class="warning-box">
                        <h2>‚ö†Ô∏è Aviso Importante</h2>
                        <p>Para concluir e validar seu cadastro, envie os seguintes documentos pelo WhatsApp:</p>
                        <ul>
                            <li><i class="fas fa-id-card"></i> üìÑ Documento: CPF e RG ou CNH</li>
                            <li><i class="fas fa-camera"></i> ü§≥ Selfie segurando o documento</li>
                        </ul>
                        <p>üí° <strong>Observa√ß√£o:</strong> A CNH v√°lida pode substituir CPF, RG e comprovante de resid√™ncia.</p>
                        <button class="action-button secondary warning-back-btn" onclick="goToStep(7)">‚¨ÖÔ∏è Voltar para Revis√£o</button>
                    </div>
                </div>
            </form>
        </div>
    </main>
    
    <div class="action-button-wrapper">
        <div class="container action-buttons-container">
            <button id="back-btn" class="action-button secondary">Voltar</button>
            <button id="next-btn" class="action-button primary">Pr√≥ximo</button>
        </div>
    </div>

    <nav class="standard-footer">
        <div class="container">
            <a href="../../index.html" class="footer-btn"><i class="fas fa-home footer-icon"></i></a>
            <a href="https://wa.me/5544998408460" target="_blank" class="footer-btn"><i class="fab fa-whatsapp footer-icon"></i></a>
            <a href="https://www.instagram.com/encomendapalotina" target="_blank" class="footer-btn"><i class="fab fa-instagram footer-icon"></i></a>
            <div id="help-btn" class="footer-btn"><i class="fas fa-question-circle footer-icon"></i></div>
        </div>
    </nav>
    
    <div id="help-modal" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header"><h2>Como Preencher o Cadastro</h2></div>
            <div class="help-modal-body">
                <h4>Nome Completo</h4><p>Digite seu nome como est√° no seu documento de identidade.</p>
                <h4>CPF e RG</h4><p>Preencha os n√∫meros dos seus documentos. O sistema formatar√° automaticamente.</p>
                <h4>Data de Nascimento</h4><p>Selecione sua data de nascimento. Voc√™ precisa ser maior de 18 anos.</p>
                <h4>Telefone e E-mail</h4><p>Informe seus contatos principais. Usaremos para entrar em contato sobre seu cadastro.</p>
                <h4>CEP</h4><p>Digite seu CEP e aguarde o preenchimento autom√°tico do endere√ßo.</p>
                <h4>N√∫mero e Tempo de Moradia</h4><p>Complete com o n√∫mero da sua resid√™ncia e h√° quanto tempo mora no local.</p>
                <h4>Como nos conheceu</h4><p>Selecione a op√ß√£o que melhor descreve como voc√™ chegou at√© n√≥s. Se foi por indica√ß√£o, um novo campo aparecer√° para voc√™ digitar o nome de quem indicou.</p>
                <h4>Faixa Salarial</h4><p>Toque na op√ß√£o que representa sua renda mensal. Esta informa√ß√£o √© crucial para a an√°lise de cr√©dito.</p>
                <h4>Refer√™ncias</h4><p>A refer√™ncia profissional (nome e telefone) √© obrigat√≥ria. A pessoal √© opcional, mas ajuda a fortalecer seu cadastro.</p>
                <h4>Redes Sociais</h4><p>Seu perfil do Instagram √© obrigat√≥rio. As outras redes s√£o opcionais e servem para complementar sua an√°lise.</p>
            </div>
            <div class="help-modal-footer"><button id="close-help-btn" class="action-button primary">Entendi</button></div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let currentStep = 1; const totalSteps = 8;
        const stepFields = { 1: ['fullName', 'cpf', 'rg', 'birthDate', 'phone', 'email'], 2: ['cep', 'street', 'number', 'neighborhood', 'residenceTime'], 3: ['howMet', 'referrerName'], 4: ['salaryRange'], 5: ['profRefName', 'profRefPhone'], 6: ['social1']};
        const headerInfo = { 1: { i: 'fa-user-plus', t: 'Dados Pessoais', s: 'Seus dados de identifica√ß√£o.' }, 2: { i: 'fa-map-marker-alt', t: 'Endere√ßo', s: 'Onde voc√™ mora.' }, 3: { i: 'fa-question-circle', t: 'Como nos Conheceu', s: 'Nos conte como chegou at√© aqui.' }, 4: { i: 'fa-dollar-sign', t: 'Dados Financeiros', s: 'Sua renda mensal.' }, 5: { i: 'fa-users', t: 'Refer√™ncias', s: 'Contatos para refer√™ncia.' }, 6: { i: 'fa-share-alt', t: 'Redes Sociais', s: 'Seus perfis online.' }, 7: { i: 'fa-check-circle', t: 'Resumo do Cadastro', s: 'Revise todos os seus dados.' }, 8: { i: 'fa-exclamation-triangle', t: 'Aviso Final', s: 'Leia antes de enviar.' }};
        const backBtn = document.getElementById('back-btn'), nextBtn = document.getElementById('next-btn'), helpModal = document.getElementById('help-modal');

        window.goToStep = (step) => { if (step < 1 || step > totalSteps) return; document.querySelector('.form-step.active').classList.remove('active'); document.getElementById(`step-${step}`).classList.add('active'); currentStep = step; if (currentStep === 7) populateSummary(); updateUI();};
        const updateUI = () => {
            const info = headerInfo[currentStep]; document.getElementById('header-icon').className = `fas ${info.i} logo-icon`; document.getElementById('header-title').textContent = info.t; document.getElementById('header-tagline').textContent = info.s;
            backBtn.style.display = (currentStep > 1 && currentStep < 7) ? 'block' : 'none';
            nextBtn.style.display = 'block';
            if (currentStep < 7) { nextBtn.textContent = 'Pr√≥ximo'; nextBtn.className = 'action-button primary'; } 
            else if (currentStep === 7) { nextBtn.textContent = 'Confirmar e Avan√ßar'; nextBtn.className = 'action-button primary full-width'; backBtn.style.display = 'none'; } 
            else { nextBtn.textContent = '‚úÖ Entendi, Enviar no WhatsApp'; nextBtn.className = 'action-button whatsapp full-width'; backBtn.style.display = 'none';}
            document.querySelector('main').scrollTop = 0;
        };
        const populateSummary = () => {
            const summaryData = [ { t: 'Dados Pessoais', s: 1, f: { 'Nome': 'fullName', 'CPF': 'cpf', 'RG': 'rg' } }, { t: 'Endere√ßo', s: 2, f: { 'Endere√ßo': ['street', 'number'], 'Bairro': 'neighborhood', 'Moradia': 'residenceTime' } }, { t: 'Como Conheceu', s: 3, f: { 'Origem': 'howMet', 'Indicado por': 'referrerName' } }, { t: 'Financeiro', s: 4, f: { 'Faixa Salarial': 'salaryRange' } }, { t: 'Refer√™ncias', s: 5, f: { 'Profissional': ['profRefName', 'profRefPhone'], 'Pessoal': ['personalRefName', 'personalRefPhone'] } }, { t: 'Redes Sociais', s: 6, f: { 'Instagram': 'social1', 'Facebook': 'social2', 'TikTok': 'social3' } }];
            document.getElementById('summary-content').innerHTML = summaryData.map(sec => { let items = Object.entries(sec.f).map(([lbl, key]) => { let val = Array.isArray(key) ? key.map(k => localStorage.getItem(k) || '').join(', ') : localStorage.getItem(key) || ''; if (!val.trim() || val.trim() === ',') return ''; return `<div class="summary-item"><span class="label">${lbl}:</span> <span class="value">${val}</span></div>`; }).join(''); return items ? `<div class="summary-card"><div class="summary-card-header"><span class="summary-card-title">${sec.t}</span><span class="summary-edit-btn" onclick="goToStep(${sec.s})">Editar</span></div><div class="summary-card-body">${items}</div></div>` : ''; }).join('');
        };
        const validateField = (id) => { const i = document.getElementById(id); if (!i) return true; let v = i.type === 'radio' ? document.querySelector(`input[name="${i.name}"]:checked`) !== null : i.checkValidity(); if (i.id === 'rg' && v) v = /^\d{2}\.\d{3}\.\d{3}-\d$/.test(i.value); if (i.id === 'cpf' && v) v = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/.test(i.value); if (i.id === 'phone' && v) v = /^\(\d{2}\)\s\d{5}-\d{4}$/.test(i.value); i.classList.toggle('is-valid', v); i.classList.toggle('is-invalid', !v); return v; };
        const validateStep = (s) => { if (s >= 7) return true; return stepFields[s].every(id => { const el = document.getElementById(id); return !el || el.offsetParent === null || validateField(id); });};
        const submitToWhatsApp = () => { for (let i = 1; i < 7; i++) { if (!validateStep(i)) { goToStep(i); return; } } let msg = `*NOVO CADASTRO*\n\n*Pessoal:*\nNome: ${localStorage.getItem('fullName')}\nCPF: ${localStorage.getItem('cpf')}\nRG: ${localStorage.getItem('rg')}\n\n*Endere√ßo:*\n${localStorage.getItem('street')}, ${localStorage.getItem('number')} - ${localStorage.getItem('neighborhood')}\nTempo de Moradia: ${localStorage.getItem('residenceTime')}\n\n*Origem:*\nConheceu por: ${localStorage.getItem('howMet')} ${localStorage.getItem('referrerName') ? `(Indicado: ${localStorage.getItem('referrerName')})` : ''}\n\n*Refer√™ncias:*\nProfissional: ${localStorage.getItem('profRefName')} - ${localStorage.getItem('profRefPhone')}\n\n*Redes Sociais:*\nInstagram: ${localStorage.getItem('social1')}`; window.open(`https://wa.me/5544998408460?text=${encodeURIComponent(msg)}`, '_blank'); localStorage.clear();};

        nextBtn.onclick = () => { if (currentStep < 7) validateStep(currentStep) && goToStep(currentStep + 1); else if (currentStep === 7) goToStep(8); else submitToWhatsApp(); };
        backBtn.onclick = () => goToStep(currentStep - 1);
        document.getElementById('help-btn').onclick = () => helpModal.style.display = 'flex';
        document.getElementById('close-help-btn').onclick = () => helpModal.style.display = 'none';

        document.querySelectorAll('.form-control, input[type="radio"]').forEach(i => { const k = i.name || i.id, s = localStorage.getItem(k); if (i.type === 'radio') { if (s === i.value) i.checked = true; } else if (s) i.value = s; i.addEventListener(i.type === 'radio' || i.tagName === 'SELECT' ? 'change' : 'input', () => localStorage.setItem(k, i.type === 'radio' ? document.querySelector(`input[name="${k}"]:checked`).value : i.value)); if (i.type !== 'radio') i.addEventListener('blur', () => validateField(i.id));});
        
        document.querySelectorAll('input[name="howMet"]').forEach(radio => radio.addEventListener('change', e => { 
            const refField = document.getElementById('referrerField'); 
            const isIndication = e.target.value === 'Indica√ß√£o';
            refField.style.display = isIndication ? 'block' : 'none'; 
            document.getElementById('referrerName').required = isIndication; 
        }));
        const savedHowMet = document.querySelector('input[name="howMet"]:checked'); if (savedHowMet) savedHowMet.dispatchEvent(new Event('change'));
        
        document.querySelectorAll('.form-control, input[type="radio"]').forEach(i => { i.addEventListener(i.tagName === 'SELECT' || i.type === 'radio' ? 'change' : 'blur', () => { setTimeout(() => { const f = stepFields[currentStep] || []; if (f.length > 0 && (i.id === f[f.length - 1] || i.name === f[f.length - 1])) { if(validateStep(currentStep)) goToStep(currentStep + 1); } }, 100); }); });

        const applyMask = (id, func) => { const el = document.getElementById(id); if (el) el.addEventListener('input', e => e.target.value = func(e.target.value)); };
        applyMask('cpf', v => v.replace(/\D/g, '').replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d{1,2})$/, '$1-$2'));
        applyMask('rg', v => v.replace(/\D/g, '').replace(/(\d{2})(\d)/, '$1.$2').replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d)$/, '$1-$2'));
        applyMask('phone', v => v.replace(/\D/g, '').replace(/^(\d{2})(\d)/g, '($1) $2').replace(/(\d{5})(\d)/, '$1-$2'));
        applyMask('personalRefPhone', v => v.replace(/\D/g, '').replace(/^(\d{2})(\d)/g, '($1) $2').replace(/(\d{5})(\d)/, '$1-$2'));
        applyMask('profRefPhone', v => v.replace(/\D/g, '').replace(/^(\d{2})(\d)/g, '($1) $2').replace(/(\d{5})(\d)/, '$1-$2'));
        applyMask('cep', v => v.replace(/\D/g, '').replace(/(\d{5})(\d)/, '$1-$2'));
        
        document.getElementById('cep').addEventListener('blur', async (e) => { if (validateField('cep')) { const res = await fetch(`https://viacep.com.br/ws/${e.target.value.replace(/\D/g, '')}/json/`); if (res.ok) { const d = await res.json(); if (!d.erro) { ['street', 'neighborhood', 'city', 'state'].forEach(id => { const k = {street: 'logradouro', neighborhood: 'bairro', city: 'localidade', state: 'uf'}[id]; document.getElementById(id).value = d[k]; localStorage.setItem(id, d[k]); }); document.getElementById('number').focus(); } } } });
        updateUI();
    });
    </script>
</body>
</html>