<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Renegociação - Parcelamento 100% - Encomenda Palotina</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #20c997;
            --primary-dark: #198754;
            --primary-light: #d1f2eb;
            --secondary-color: #6c757d;
            --success: #28a745;
            --warning: #ffc107;
            --light-yellow: #fff3cd;
            --discount-color: #dc3545;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .calculator-container {
            width: 100%;
            min-height: 100vh;
            background: white;
            margin: 0;
            border-radius: 0;
        }
        
        .calculator-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 1.5rem 1rem;
            position: relative;
            text-align: center;
        }
        
        .btn-back-home {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 6px;
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }
        
        .btn-back-home:hover {
            background: rgba(255,255,255,0.3);
            color: white;
        }
        
        .debt-item {
            border-left: 4px solid var(--primary-color);
            background: var(--primary-light);
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 10px;
        }
        
        .installment-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--success);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        .entry-section {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
        }
        
        .summary-section {
            background: #e8f5e8;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
        }
        
        .footer-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            border-top: 2px solid #e9ecef;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .content-area {
            padding-bottom: 140px;
        }
        
        .conditions-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .phase-box {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid var(--primary-color);
        }
        
        .phase-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .value-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        /* SLIDERS PADRONIZADOS */
        .slider-container {
            padding: 0 1rem;
            position: relative;
        }
        
        .custom-slider {
            width: 100%;
            height: 6px;
            background: #dee2e6;
            border-radius: 3px;
            border: none;
            outline: none;
            margin: 20px 0;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-color);
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .custom-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-color);
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: -10px;
            font-size: 0.8rem;
            color: #666;
        }
        
        /* 🔧 RODAPÉ PADRONIZADO */
        .footer-btn {
            height: 50px;
            font-weight: 600;
            border-radius: 8px;
            border: 2px solid #000;
            font-size: 0.9rem;
        }
        
        .btn-home {
            background: #ff6b35;
            color: white;
        }
        
        .btn-new {
            background: #ffd166;
            color: #000;
        }
        
        .btn-summary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-whatsapp-footer {
            background: #e9ecef;
            color: #000;
            border: 2px solid #000;
            height: 50px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
        }
        
        .btn-whatsapp-footer.active {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            border: 2px solid #128C7E;
        }
        
        .interest-badge {
            background: #ffc107;
            color: #000;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .discount-badge {
            background: var(--discount-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .discount-section {
            background: #f8d7da;
            border: 2px solid var(--discount-color);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .last-installment {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--discount-color);
            text-decoration: line-through;
        }
        
        .last-installment-discount {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--success);
        }
        
        @media (max-width: 768px) {
            .calculator-header {
                padding: 1rem;
            }
            
            .installment-display {
                font-size: 2rem;
            }
            
            .footer-btn {
                height: 45px;
                font-size: 0.8rem;
            }
            
            .last-installment, .last-installment-discount {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <!-- Header -->
        <div class="calculator-header">
            <button class="btn btn-back-home" onclick="goBackToHome()">
                <i class="bi bi-arrow-left me-1"></i>Voltar
            </button>
            <h1 style="font-size: 1.5rem; margin: 0;"><i class="bi bi-percent me-2"></i>Parcelamento 100%</h1>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; opacity: 0.9;">Renegocie 100% do valor em até 120x</p>
        </div>

        <!-- Conteúdo Principal -->
        <div class="content-area">
            <div class="p-3">
                <!-- Dados do Cliente -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-person-badge me-2"></i>Seus Dados</h4>
                    <div class="row g-2">
                        <div class="col-12">
                            <input type="text" class="form-control" id="clientName" placeholder="Nome completo">
                        </div>
                        <div class="col-12">
                            <input type="text" class="form-control" id="clientCPF" placeholder="CPF (000.000.000-00)">
                        </div>
                    </div>
                </div>

                <!-- Condições Especiais -->
                <div class="conditions-box">
                    <h5 class="text-center mb-3"><i class="bi bi-info-circle me-2"></i>Condições Especiais</h5>
                    <div class="phase-box">
                        <div class="phase-title">📋 Condições Gerais</div>
                        <div>• Parcelamento de <strong>100%</strong> do valor</div>
                        <div>• Taxa: <strong>1.5% ao mês</strong></div>
                        <div>• Máximo: <strong>120 parcelas</strong></div>
                    </div>
                    <div class="phase-box">
                        <div class="phase-title">🎁 Condição Especial</div>
                        <div>• Última parcela com <strong>50% de desconto</strong></div>
                        <div>• Pagamento da última parcela pode ser antecipado</div>
                        <div>• Desconto válido para qualquer parcela final</div>
                    </div>
                </div>

                <!-- Dívidas -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-receipt me-2"></i>Valor Total da Dívida</h4>
                    <div id="debtsContainer">
                        <!-- Dívidas serão adicionadas aqui -->
                    </div>
                    <button class="btn btn-outline-primary w-100 mt-2" onclick="addDebt()">
                        <i class="bi bi-plus-circle me-1"></i>Adicionar Valor
                    </button>
                </div>

                <!-- Seção de Desconto Especial -->
                <div class="discount-section">
                    <h5 class="text-center mb-3"><i class="bi bi-gift me-2"></i>Condição Especial - Última Parcela</h5>
                    <div class="text-center">
                        <div class="mb-2">Última parcela com <strong>50% DE DESCONTO</strong></div>
                        <div class="last-installment" id="lastInstallmentOriginal">R$ 0,00</div>
                        <div class="last-installment-discount" id="lastInstallmentDiscount">R$ 0,00</div>
                        <small class="text-muted">Você economiza <span id="discountSavings">R$ 0,00</span></small>
                    </div>
                </div>

                <!-- Parcelamento Principal -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-calendar-range me-2"></i>Parcelamento Principal</h4>
                    <div class="slider-container">
                        <input type="range" class="custom-slider" id="installmentsRange" min="2" max="120" value="12">
                        <div class="slider-labels">
                            <span>2x</span>
                            <span>120x</span>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <div class="installment-display" id="installmentDisplay">R$ 0,00</div>
                        <small class="text-muted fw-semibold">
                            <span id="installmentsValue">12</span> parcelas • 
                            <span class="interest-badge">1.5% a.m.</span>
                        </small>
                    </div>
                </div>

                <!-- Resumo (inicialmente escondido) -->
                <div class="summary-section hidden" id="summarySection">
                    <h5 class="text-center mb-3"><i class="bi bi-file-text me-2"></i>Resumo da Renegociação</h5>
                    <div id="summaryContent">
                        <!-- Conteúdo do resumo será gerado aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 🔧 RODAPÉ PADRONIZADO -->
        <div class="footer-actions">
            <div class="row g-2">
                <div class="col-4">
                    <button class="btn btn-home footer-btn w-100" onclick="goBackToHome()">
                        <i class="bi bi-house me-1"></i>Home
                    </button>
                </div>
                <div class="col-4">
                    <button class="btn btn-new footer-btn w-100" onclick="resetCalculator()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Nova
                    </button>
                </div>
                <div class="col-4">
                    <button class="btn btn-summary footer-btn w-100" onclick="showSummary()">
                        <i class="bi bi-eye me-1"></i>Ver Resumo
                    </button>
                </div>
                <div class="col-12 mt-2">
                    <button class="btn btn-whatsapp-footer" id="whatsappFooterBtn" onclick="sendWhatsApp()">
                        <i class="bi bi-whatsapp me-1"></i>Enviar WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variáveis globais
        let debtCount = 0;

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            addDebt();
            updateCalculations();
            setupEventListeners();
        });

        // Configura event listeners
        function setupEventListeners() {
            document.getElementById('installmentsRange').addEventListener('input', updateCalculations);
        }

        // 🔧 FUNÇÃO VOLTAR PARA HOME PADRONIZADA
        function goBackToHome() {
            window.location.href = '../index.html';
        }

        // Adicionar dívida (APENAS VALOR - SEM DESCRIÇÃO)
        function addDebt() {
            if (debtCount >= 10) {
                alert('Máximo de 10 valores atingido!');
                return;
            }

            debtCount++;
            const debtId = `debt-${debtCount}`;
            
            const debtHTML = `
                <div class="debt-item" id="${debtId}">
                    <div class="row g-2 align-items-center">
                        <div class="col-12">
                            <input type="text" class="form-control debt-value" placeholder="R$ 0,00" oninput="formatCurrency(this); updateCalculations()">
                        </div>
                        <div class="col-12 text-end mt-1">
                            ${debtCount > 1 ? 
                                `<button class="btn btn-danger btn-sm" onclick="removeDebt('${debtId}')">
                                    <i class="bi bi-trash"></i> Remover
                                </button>` : 
                                ''
                            }
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('debtsContainer').insertAdjacentHTML('beforeend', debtHTML);
            updateCalculations();
        }

        // Remover dívida
        function removeDebt(debtId) {
            const debtElement = document.getElementById(debtId);
            if (debtElement) {
                debtElement.remove();
                debtCount--;
                updateCalculations();
            }
        }

        // Formatação de moeda
        function formatCurrency(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value === '') {
                input.value = '';
                return;
            }
            
            let number = parseInt(value) / 100;
            input.value = formatCurrencyValue(number);
        }

        // Formata valor para moeda
        function formatCurrencyValue(value) {
            return value.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
        }

        // Obtém valor numérico do campo de moeda
        function getCurrencyValue(currencyString) {
            if (!currencyString) return 0;
            let value = currencyString.replace('R$', '')
                                    .replace(/\./g, '')
                                    .replace(',', '.')
                                    .trim();
            return parseFloat(value) || 0;
        }

        // Calcula total das dívidas
        function calculateTotalDebts() {
            let total = 0;
            const debtElements = document.querySelectorAll('.debt-item');
            
            debtElements.forEach(debtElement => {
                const valueInput = debtElement.querySelector('.debt-value');
                const value = getCurrencyValue(valueInput.value);
                total += value;
            });
            
            return total;
        }

        // Cálculo do valor da parcela com juros
        function calculateInstallment(totalValue, installments, interestRate) {
            if (installments === 1) return totalValue;
            if (installments === 0) return 0;
            
            const numerator = interestRate * Math.pow(1 + interestRate, installments);
            const denominator = Math.pow(1 + interestRate, installments) - 1;
            
            return totalValue * (numerator / denominator);
        }

        // Função para calcular datas
        function calculateDates(installments) {
            const today = new Date();
            
            const firstPayment = new Date(today);
            firstPayment.setMonth(firstPayment.getMonth() + 1);
            
            const lastPayment = new Date(firstPayment);
            lastPayment.setMonth(lastPayment.getMonth() + installments - 1);
            
            return {
                firstPayment: firstPayment,
                lastPayment: lastPayment
            };
        }

        // Atualiza todos os cálculos
        function updateCalculations() {
            const totalDebts = calculateTotalDebts();
            const installments = parseInt(document.getElementById('installmentsRange').value);
            
            // Atualiza valor do slider
            document.getElementById('installmentsValue').textContent = installments;
            
            // Calcula valor da parcela normal (1.5% a.m.)
            let installmentValue = 0;
            if (totalDebts > 0 && installments > 0) {
                installmentValue = calculateInstallment(totalDebts, installments, 0.015); // 1.5% a.m.
            }
            
            document.getElementById('installmentDisplay').textContent = formatCurrencyValue(installmentValue);
            
            // Calcula desconto na última parcela (50%)
            const lastInstallmentOriginal = installmentValue;
            const lastInstallmentDiscount = installmentValue * 0.5; // 50% de desconto
            const discountSavings = installmentValue - lastInstallmentDiscount;
            
            document.getElementById('lastInstallmentOriginal').textContent = formatCurrencyValue(lastInstallmentOriginal);
            document.getElementById('lastInstallmentDiscount').textContent = formatCurrencyValue(lastInstallmentDiscount);
            document.getElementById('discountSavings').textContent = formatCurrencyValue(discountSavings);
        }

        // Mostrar resumo
        function showSummary() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientCPF = document.getElementById('clientCPF').value.trim();
            const totalDebts = calculateTotalDebts();
            
            // Validações
            if (!clientName) {
                alert('Por favor, informe seu nome.');
                return;
            }
            
            if (!clientCPF || clientCPF.replace(/\D/g, '').length !== 11) {
                alert('Por favor, informe um CPF válido.');
                return;
            }
            
            if (totalDebts === 0) {
                alert('Por favor, adicione pelo menos um valor.');
                return;
            }
            
            const installments = parseInt(document.getElementById('installmentsRange').value);
            const installmentValue = getCurrencyValue(document.getElementById('installmentDisplay').textContent);
            const lastInstallmentDiscount = getCurrencyValue(document.getElementById('lastInstallmentDiscount').textContent);
            
            // Calcula datas
            const dates = calculateDates(installments);
            const today = new Date();
            
            // Monta resumo
            const summaryHTML = `
                <div class="mb-3">
                    <strong>Data da Proposta:</strong> ${today.toLocaleDateString('pt-BR')}
                </div>
                <div class="mb-3">
                    <strong>Cliente:</strong> ${clientName}<br>
                    <strong>CPF:</strong> ${clientCPF}
                </div>
                <div class="mb-3">
                    <strong>Valor Total Renegociado:</strong><br>
                    <div class="d-flex justify-content-between fw-bold fs-5">
                        <span>Total:</span>
                        <span>${formatCurrencyValue(totalDebts)}</span>
                    </div>
                </div>
                
                <div class="mb-3 p-3 bg-light rounded">
                    <strong>📅 PARCELAMENTO PRINCIPAL</strong><br>
                    <div class="fw-bold">${installments - 1}x de ${formatCurrencyValue(installmentValue)}</div>
                    <small class="text-muted">
                        Início: ${dates.firstPayment.toLocaleDateString('pt-BR')}<br>
                        Taxa: 1.5% ao mês
                    </small>
                </div>
                
                <div class="mb-3 p-3 bg-success text-white rounded">
                    <strong>🎁 ÚLTIMA PARCELA COM DESCONTO</strong><br>
                    <div class="fw-bold">1x de ${formatCurrencyValue(lastInstallmentDiscount)}</div>
                    <small>
                        Vencimento: ${dates.lastPayment.toLocaleDateString('pt-BR')}<br>
                        <strong>50% DE DESCONTO</strong> - Economia de ${formatCurrencyValue(installmentValue - lastInstallmentDiscount)}
                    </small>
                </div>
                
                <div class="mb-3">
                    <strong>Resumo do Pagamento:</strong><br>
                    • ${installments - 1} parcelas normais: ${formatCurrencyValue(installmentValue)}<br>
                    • 1 parcela final: ${formatCurrencyValue(lastInstallmentDiscount)} <span class="discount-badge">-50%</span><br>
                    • Total: <strong>${installments} meses</strong>
                </div>
                
                <div class="alert alert-info">
                    <strong>💡 Condição Especial:</strong> Você pode antecipar o pagamento da última parcela com desconto a qualquer momento!
                </div>
            `;
            
            document.getElementById('summaryContent').innerHTML = summaryHTML;
            document.getElementById('summarySection').classList.remove('hidden');
            
            // 🔧 ATIVA BOTÃO WHATSAPP
            document.getElementById('whatsappFooterBtn').classList.add('active');
            
            // Scroll para o resumo
            document.getElementById('summarySection').scrollIntoView({ behavior: 'smooth' });
        }

        // Enviar para WhatsApp
        function sendWhatsApp() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientCPF = document.getElementById('clientCPF').value.trim();
            const totalDebts = calculateTotalDebts();
            const installments = parseInt(document.getElementById('installmentsRange').value);
            const installmentValue = getCurrencyValue(document.getElementById('installmentDisplay').textContent);
            const lastInstallmentDiscount = getCurrencyValue(document.getElementById('lastInstallmentDiscount').textContent);
            
            // Calcula datas
            const dates = calculateDates(installments);
            const today = new Date();
            
            const message = `*💎 PROPOSTA - PARCELAMENTO 100% COM DESCONTO*\n\n` +
                           `*Data:* ${today.toLocaleDateString('pt-BR')}\n` +
                           `*Cliente:* ${clientName}\n` +
                           `*CPF:* ${clientCPF}\n\n` +
                           `*VALOR TOTAL RENEGOCIADO: ${formatCurrencyValue(totalDebts)}*\n\n` +
                           `*📅 PARCELAMENTO PRINCIPAL (${installments - 1}x)*\n` +
                           `Parcela: ${formatCurrencyValue(installmentValue)}\n` +
                           `Início: ${dates.firstPayment.toLocaleDateString('pt-BR')}\n` +
                           `*Taxa: 1.5% ao mês*\n\n` +
                           `*🎁 ÚLTIMA PARCELA COM DESCONTO (1x)*\n` +
                           `Parcela: ${formatCurrencyValue(lastInstallmentDiscount)}\n` +
                           `Vencimento: ${dates.lastPayment.toLocaleDateString('pt-BR')}\n` +
                           `*DESCONTO DE 50%* - Economia de ${formatCurrencyValue(installmentValue - lastInstallmentDiscount)}\n\n` +
                           `*RESUMO DO PAGAMENTO:*\n` +
                           `• ${installments - 1} parcelas normais: ${formatCurrencyValue(installmentValue)}\n` +
                           `• 1 parcela final: ${formatCurrencyValue(lastInstallmentDiscount)} (-50%)\n` +
                           `• Total: ${installments} meses\n\n` +
                           `*💡 CONDIÇÃO ESPECIAL:*\n` +
                           `Você pode antecipar o pagamento da última parcela com desconto a qualquer momento!\n\n` +
                           `_*Proposta sujeita à análise e aprovação*_\n` +
                           `📞 *Encomenda Palotina*\n` +
                           `💚 https://wa.me/554498408460`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/554498408460?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // Reset da calculadora
        function resetCalculator() {
            if (confirm('Deseja começar uma nova simulação?')) {
                document.getElementById('clientName').value = '';
                document.getElementById('clientCPF').value = '';
                document.getElementById('installmentsRange').value = 12;
                document.getElementById('summarySection').classList.add('hidden');
                
                // 🔧 DESATIVA BOTÃO WHATSAPP
                document.getElementById('whatsappFooterBtn').classList.remove('active');
                
                // Remove todas as dívidas exceto a primeira
                const debtsContainer = document.getElementById('debtsContainer');
                const firstDebt = debtsContainer.querySelector('.debt-item');
                
                debtsContainer.innerHTML = '';
                if (firstDebt) {
                    debtsContainer.appendChild(firstDebt);
                    firstDebt.querySelector('.debt-value').value = '';
                }
                
                debtCount = 1;
                updateCalculations();
            }
        }

        // Formatação automática do CPF
        document.getElementById('clientCPF').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            if (value.length > 3) value = value.replace(/^(\d{3})(\d)/, '$1.$2');
            if (value.length > 6) value = value.replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3');
            if (value.length > 9) value = value.replace(/^(\d{3})\.(\d{3})\.(\d{3})(\d)/, '$1.$2.$3-$4');
            e.target.value = value;
        });
    </script>
</body>
</html>