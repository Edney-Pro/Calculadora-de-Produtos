<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M√≥veis com Montagem - Encomenda Palotina</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --magalu-blue: #007bff;
            --magalu-dark-blue: #0056b3;
            --magalu-light-blue: #e3f2fd;
            --success: #28a745;
            --warning: #ffc107;
            --light-yellow: #fff3cd;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .calculator-container {
            width: 100%;
            min-height: 100vh;
            background: white;
            margin: 0;
            border-radius: 0;
        }
        
        .calculator-header {
            background: linear-gradient(135deg, var(--magalu-blue), var(--magalu-dark-blue));
            color: white;
            padding: 1.5rem 1rem;
            position: relative;
        }
        
        .product-item {
            border-left: 4px solid var(--magalu-blue);
            background: var(--magalu-light-blue);
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 10px;
        }
        
        .installment-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--success);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            border: none;
            font-weight: 600;
            border-radius: 8px;
            color: white;
        }
        
        .btn-primary {
            background: var(--magalu-blue);
            border-color: var(--magalu-blue);
            font-weight: 600;
            border-radius: 8px;
        }
        
        .btn-financing {
            width: 48%;
            margin: 1%;
            padding: 12px;
            border: 2px solid #dee2e6;
            background: white;
            color: #333;
            font-weight: 600;
            border-radius: 8px;
        }
        
        .btn-financing.active {
            background: var(--magalu-blue);
            border-color: var(--magalu-blue);
            color: white;
        }
        
        .btn-entry {
            width: 48%;
            margin: 1%;
            padding: 12px;
            border: 2px solid var(--magalu-blue);
            background: white;
            color: var(--magalu-blue);
            font-weight: 600;
            font-size: 0.9rem;
            border-radius: 8px;
        }
        
        .btn-entry.active {
            background: var(--magalu-blue);
            color: white;
        }

        .btn-montagem {
            width: 48%;
            margin: 1%;
            padding: 12px;
            border: 2px solid var(--warning);
            background: white;
            color: var(--warning);
            font-weight: 600;
            border-radius: 8px;
        }
        
        .btn-montagem.active {
            background: var(--warning);
            border-color: var(--warning);
            color: white;
        }
        
        .btn-reset {
            background: var(--light-yellow);
            border: 2px solid #ffc107;
            color: #856404;
            font-weight: 600;
            border-radius: 8px;
        }
        
        .btn-reset:hover {
            background: #ffeaa7;
            color: #856404;
        }
        
        .btn-back {
            background: #6c757d;
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 8px;
        }
        
        .section-title {
            color: var(--magalu-blue);
            border-left: 4px solid var(--magalu-blue);
            padding-left: 12px;
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        .entry-section {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
        }
        
        .summary-section {
            background: #e8f5e8;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
        }
        
        .footer-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            border-top: 2px solid #e9ecef;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .content-area {
            padding-bottom: 120px;
        }
        
        .conditions-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .phase-box {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid var(--magalu-blue);
        }
        
        .phase-title {
            font-weight: 600;
            color: var(--magalu-blue);
            margin-bottom: 0.5rem;
        }
        
        .value-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--magalu-blue);
        }
        
        /* SLIDERS PADRONIZADOS */
        .slider-container {
            padding: 0 1rem;
            position: relative;
        }
        
        .custom-slider {
            width: 100%;
            height: 6px;
            background: #dee2e6;
            border-radius: 3px;
            border: none;
            outline: none;
            margin: 20px 0;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--magalu-blue);
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .custom-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--magalu-blue);
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: -10px;
            font-size: 0.8rem;
            color: #666;
        }
        
        .montagem-section {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            border-left: 4px solid var(--warning);
        }
        
        .montagem-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--warning);
        }
        
        /* Otimiza√ß√µes para mobile */
        .form-control, .btn {
            font-size: 16px !important;
        }
        
        @media (max-width: 768px) {
            .calculator-header {
                padding: 1rem;
            }
            
            .installment-display {
                font-size: 2rem;
            }
            
            .btn-financing, .btn-entry, .btn-montagem {
                width: 100%;
                margin: 5px 0;
            }
            
            .btn-entry {
                padding: 10px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <!-- Header -->
        <div class="calculator-header text-center">
            <h1 style="font-size: 1.5rem; margin: 0;"><i class="bi bi-house-door me-2"></i>M√≥veis com Montagem</h1>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; opacity: 0.9;">Simule seu parcelamento + montagem</p>
        </div>

        <!-- Conte√∫do Principal -->
        <div class="content-area">
            <div class="p-3">
                <!-- Dados do Cliente -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-person-badge me-2"></i>Seus Dados</h4>
                    <div class="row g-2">
                        <div class="col-12">
                            <input type="text" class="form-control" id="clientName" placeholder="Nome completo">
                        </div>
                        <div class="col-12">
                            <input type="text" class="form-control" id="clientCPF" placeholder="CPF (000.000.000-00)">
                        </div>
                    </div>
                </div>

                <!-- M√≥veis -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-house-door me-2"></i>M√≥veis</h4>
                    <div id="productsContainer">
                        <!-- M√≥veis ser√£o adicionados aqui -->
                    </div>
                    <button class="btn btn-outline-primary w-100 mt-2" onclick="addProduct()">
                        <i class="bi bi-plus-circle me-1"></i>Adicionar M√≥vel
                    </button>
                </div>

                <!-- Montagem -->
                <div class="montagem-section">
                    <h4 class="section-title"><i class="bi bi-tools me-2"></i>Servi√ßo de Montagem</h4>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Valor da Montagem:</span>
                            <span class="montagem-value" id="montagemValue">R$ 0,00</span>
                        </div>
                    </div>
                    <div class="d-flex flex-wrap justify-content-between">
                        <button class="btn btn-montagem active" id="btnMontagemParcelar" onclick="setMontagemType('parcelar')">
                            Parcelar Montagem
                        </button>
                        <button class="btn btn-montagem" id="btnMontagemAvista" onclick="setMontagemType('avista')">
                            Pagar √† Vista
                        </button>
                    </div>
                </div>

                <!-- Tipo de Financiamento -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-credit-card me-2"></i>Tipo de Financiamento</h4>
                    <div class="d-flex flex-wrap justify-content-between">
                        <button class="btn btn-financing active" id="btnNoEntry" onclick="setFinancingType('no')">
                            Sem Entrada
                        </button>
                        <button class="btn btn-financing" id="btnYesEntry" onclick="setFinancingType('yes')">
                            Com Entrada
                        </button>
                    </div>
                </div>

                <!-- Se√ß√£o de Entrada (inicialmente escondida) -->
                <div class="entry-section hidden" id="entrySection">
                    <h5 class="mb-3">Valor da Entrada</h5>
                    <div class="d-flex flex-wrap justify-content-between mb-3" id="entryButtons">
                        <!-- Bot√µes de entrada ser√£o gerados aqui -->
                    </div>
                    <div class="row g-2">
                        <div class="col-8">
                            <input type="text" class="form-control" id="customEntry" placeholder="Ou digite o valor">
                        </div>
                        <div class="col-4">
                            <button class="btn btn-outline-primary w-100" onclick="applyCustomEntry()">Aplicar</button>
                        </div>
                    </div>
                </div>

                <!-- Parcelas -->
                <div class="mb-4">
                    <h4 class="section-title"><i class="bi bi-calendar-range me-2"></i>Parcelas</h4>
                    <div class="slider-container">
                        <input type="range" class="custom-slider" id="installmentsRange" min="1" max="36" value="1">
                        <div class="slider-labels">
                            <span>1x</span>
                            <span>36x</span>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <div class="installment-display" id="installmentDisplay">R$ 0,00</div>
                        <small class="text-muted fw-semibold">
                            <span id="installmentsValue">1</span> parcela
                        </small>
                    </div>
                </div>

                <!-- Resumo (inicialmente escondido) -->
                <div class="summary-section hidden" id="summarySection">
                    <h5 class="text-center mb-3"><i class="bi bi-file-text me-2"></i>Resumo da Simula√ß√£o</h5>
                    <div id="summaryContent">
                        <!-- Conte√∫do do resumo ser√° gerado aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Rodap√© com A√ß√µes -->
        <div class="footer-actions">
            <div class="row g-2">
                <div class="col-4">
                    <button class="btn btn-back w-100" onclick="goBackToHome()">
                        <i class="bi bi-house me-1"></i>Home
                    </button>
                </div>
                <div class="col-4">
                    <button class="btn btn-reset w-100" onclick="resetCalculator()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Nova
                    </button>
                </div>
                <div class="col-4">
                    <button class="btn btn-whatsapp w-100" onclick="showSummary()">
                        <i class="bi bi-eye me-1"></i>Ver Resumo
                    </button>
                </div>
                <div class="col-12 mt-2 hidden" id="whatsappButton">
                    <button class="btn btn-whatsapp w-100" onclick="sendWhatsApp()">
                        <i class="bi bi-whatsapp me-1"></i>Enviar WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Vari√°veis globais
        let productCount = 0;
        let currentEntry = 0;
        let financingType = 'no';
        let montagemType = 'parcelar'; // 'parcelar' ou 'avista'

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            addProduct();
            updateCalculations();
            setupEventListeners();
        });

        // Configura event listeners
        function setupEventListeners() {
            document.getElementById('installmentsRange').addEventListener('input', updateCalculations);
            document.getElementById('customEntry').addEventListener('input', function(e) {
                formatCurrency(this);
            });
        }

        // Fun√ß√£o para voltar para home
        function goBackToHome() {
            window.location.href = 'index.html';
        }

        // Adicionar m√≥vel (75% nome, 25% pre√ßo)
        function addProduct() {
            if (productCount >= 15) {
                alert('M√°ximo de 15 m√≥veis atingido!');
                return;
            }

            productCount++;
            const productId = `product-${productCount}`;
            
            const productHTML = `
                <div class="product-item" id="${productId}">
                    <div class="row g-2 align-items-center">
                        <div class="col-9">
                            <input type="text" class="form-control product-name" placeholder="Nome do m√≥vel" oninput="updateCalculations()">
                        </div>
                        <div class="col-3">
                            <input type="text" class="form-control product-value" placeholder="R$ 0,00" oninput="formatCurrency(this); updateCalculations()">
                        </div>
                        <div class="col-12 text-end mt-1">
                            ${productCount > 1 ? 
                                `<button class="btn btn-danger btn-sm" onclick="removeProduct('${productId}')">
                                    <i class="bi bi-trash"></i> Remover
                                </button>` : 
                                ''
                            }
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('productsContainer').insertAdjacentHTML('beforeend', productHTML);
            updateCalculations();
        }

        // Remover m√≥vel
        function removeProduct(productId) {
            const productElement = document.getElementById(productId);
            if (productElement) {
                productElement.remove();
                productCount--;
                updateCalculations();
            }
        }

        // Definir tipo de financiamento
        function setFinancingType(type) {
            financingType = type;
            
            // Atualiza bot√µes
            document.getElementById('btnNoEntry').classList.toggle('active', type === 'no');
            document.getElementById('btnYesEntry').classList.toggle('active', type === 'yes');
            
            // Mostra/oculta se√ß√£o de entrada
            document.getElementById('entrySection').classList.toggle('hidden', type === 'no');
            
            if (type === 'yes') {
                generateEntryButtons();
            }
            
            updateCalculations();
        }

        // Definir tipo de montagem
        function setMontagemType(type) {
            montagemType = type;
            
            // Atualiza bot√µes
            document.getElementById('btnMontagemParcelar').classList.toggle('active', type === 'parcelar');
            document.getElementById('btnMontagemAvista').classList.toggle('active', type === 'avista');
            
            updateCalculations();
        }

        // Gerar bot√µes de entrada (APENAS VALORES EM REAIS)
        function generateEntryButtons() {
            const total = calculateTotalProducts();
            const entryButtons = document.getElementById('entryButtons');
            entryButtons.innerHTML = '';
            
            const percentages = [10, 20, 30, 40];
            
            percentages.forEach(percent => {
                const value = (total * percent / 100);
                const button = document.createElement('button');
                button.className = 'btn btn-entry';
                button.innerHTML = `${formatCurrencyValue(value)}`;
                button.onclick = () => setEntryValue(value);
                entryButtons.appendChild(button);
            });
        }

        // Definir valor da entrada
        function setEntryValue(value) {
            currentEntry = value;
            document.getElementById('customEntry').value = formatCurrencyValue(value);
            
            // Atualiza bot√µes ativos
            document.querySelectorAll('.btn-entry').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateCalculations();
        }

        // Aplicar entrada customizada
        function applyCustomEntry() {
            const customValue = getCurrencyValue(document.getElementById('customEntry').value);
            currentEntry = customValue;
            
            // Remove active de todos os bot√µes
            document.querySelectorAll('.btn-entry').forEach(btn => {
                btn.classList.remove('active');
            });
            
            updateCalculations();
        }

        // Formata√ß√£o de moeda
        function formatCurrency(input) {
            let value = input.value.replace(/\D/g, '');
            
            if (value === '') {
                input.value = '';
                return;
            }
            
            let number = parseInt(value) / 100;
            input.value = formatCurrencyValue(number);
        }

        // Formata valor para moeda
        function formatCurrencyValue(value) {
            return value.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
        }

        // Obt√©m valor num√©rico do campo de moeda
        function getCurrencyValue(currencyString) {
            if (!currencyString) return 0;
            let value = currencyString.replace('R$', '')
                                    .replace(/\./g, '')
                                    .replace(',', '.')
                                    .trim();
            return parseFloat(value) || 0;
        }

        // Calcula total dos m√≥veis
        function calculateTotalProducts() {
            let total = 0;
            const productElements = document.querySelectorAll('.product-item');
            
            productElements.forEach(productElement => {
                const valueInput = productElement.querySelector('.product-value');
                const value = getCurrencyValue(valueInput.value);
                total += value;
            });
            
            return total;
        }

        // Calcula valor da montagem (10% sobre o total)
        function calculateMontagemValue() {
            const totalProducts = calculateTotalProducts();
            return totalProducts * 0.10; // 10% de montagem
        }

        // C√°lculo da taxa de juros progressiva (INTERNA - CLIENTE N√ÉO V√ä)
        function calculateInterestRate(installments, hasEntry) {
            if (installments === 1) return 0;
            
            if (hasEntry) {
                return 0.14 - (0.14 - 0.05) * ((installments - 1) / 35);
            } else {
                return 0.18 - (0.18 - 0.08) * ((installments - 1) / 35);
            }
        }

        // C√°lculo do valor da parcela
        function calculateInstallment(totalValue, installments, hasEntry, entryValue = 0) {
            if (installments === 1) return totalValue - entryValue;
            
            const financedValue = totalValue - entryValue;
            if (financedValue <= 0) return 0;
            
            const interestRate = calculateInterestRate(installments, hasEntry);
            const numerator = interestRate * Math.pow(1 + interestRate, installments);
            const denominator = Math.pow(1 + interestRate, installments) - 1;
            
            return financedValue * (numerator / denominator);
        }

        // Atualiza todos os c√°lculos
        function updateCalculations() {
            const installments = parseInt(document.getElementById('installmentsRange').value);
            const hasEntry = financingType === 'yes';
            const totalProducts = calculateTotalProducts();
            const montagemValue = calculateMontagemValue();
            
            document.getElementById('installmentsValue').textContent = installments;
            
            // Atualiza valor da montagem
            document.getElementById('montagemValue').textContent = formatCurrencyValue(montagemValue);
            
            // Atualiza bot√µes de entrada se necess√°rio
            if (hasEntry) {
                generateEntryButtons();
            }
            
            // Calcula valor total (m√≥veis + montagem se parcelada)
            let totalFinanciado = totalProducts;
            if (montagemType === 'parcelar') {
                totalFinanciado += montagemValue;
            }
            
            // Calcula valor da parcela
            const installmentValue = calculateInstallment(totalFinanciado, installments, hasEntry, currentEntry);
            
            // Atualiza display
            document.getElementById('installmentDisplay').textContent = formatCurrencyValue(installmentValue);
        }

        // Mostrar resumo
        function showSummary() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientCPF = document.getElementById('clientCPF').value.trim();
            const totalProducts = calculateTotalProducts();
            const montagemValue = calculateMontagemValue();
            
            // Valida√ß√µes
            if (!clientName) {
                alert('Por favor, informe seu nome.');
                return;
            }
            
            if (!clientCPF || clientCPF.replace(/\D/g, '').length !== 11) {
                alert('Por favor, informe um CPF v√°lido.');
                return;
            }
            
            if (totalProducts === 0) {
                alert('Por favor, adicione pelo menos um m√≥vel.');
                return;
            }
            
            const installments = parseInt(document.getElementById('installmentsRange').value);
            const hasEntry = financingType === 'yes';
            const totalFinanciado = totalProducts + (montagemType === 'parcelar' ? montagemValue : 0);
            const financedValue = totalFinanciado - currentEntry;
            
            // Calcula datas
            const today = new Date();
            const firstPayment = new Date(today);
            firstPayment.setMonth(firstPayment.getMonth() + 1);
            
            const lastPayment = new Date(firstPayment);
            lastPayment.setMonth(lastPayment.getMonth() + installments - 1);
            
            // Monta resumo
            let productsHTML = '';
            const productElements = document.querySelectorAll('.product-item');
            productElements.forEach((productElement, index) => {
                const nameInput = productElement.querySelector('.product-name');
                const valueInput = productElement.querySelector('.product-value');
                const name = nameInput.value.trim() || `M√≥vel ${index + 1}`;
                const value = getCurrencyValue(valueInput.value);
                productsHTML += `<div class="d-flex justify-content-between"><span>${name}</span><span>${formatCurrencyValue(value)}</span></div>`;
            });
            
            const summaryHTML = `
                <div class="mb-3">
                    <strong>Data do Or√ßamento:</strong> ${today.toLocaleDateString('pt-BR')}
                </div>
                <div class="mb-3">
                    <strong>Cliente:</strong> ${clientName}<br>
                    <strong>CPF:</strong> ${clientCPF}
                </div>
                <div class="mb-3">
                    <strong>M√≥veis:</strong>
                    ${productsHTML}
                    <hr>
                    <div class="d-flex justify-content-between fw-bold">
                        <span>Total M√≥veis:</span>
                        <span>${formatCurrencyValue(totalProducts)}</span>
                    </div>
                </div>
                <div class="mb-3">
                    <strong>Montagem:</strong><br>
                    Valor: ${formatCurrencyValue(montagemValue)}<br>
                    Forma: ${montagemType === 'parcelar' ? 'Parcelada junto com os m√≥veis' : '√Ä vista (separado)'}
                </div>
                <div class="mb-3">
                    <strong>Condi√ß√µes:</strong><br>
                    ${hasEntry ? `Entrada: ${formatCurrencyValue(currentEntry)}<br>` : 'Sem entrada<br>'}
                    ${hasEntry ? `Valor financiado: ${formatCurrencyValue(financedValue)}<br>` : ''}
                    Parcelas: ${installments}x de ${document.getElementById('installmentDisplay').textContent}
                </div>
                <div class="mb-3">
                    <strong>Datas:</strong><br>
                    1¬™ Parcela: ${firstPayment.toLocaleDateString('pt-BR')}<br>
                    √öltima Parcela: ${lastPayment.toLocaleDateString('pt-BR')}
                </div>
            `;
            
            document.getElementById('summaryContent').innerHTML = summaryHTML;
            document.getElementById('summarySection').classList.remove('hidden');
            document.getElementById('whatsappButton').classList.remove('hidden');
            
            // Scroll para o resumo
            document.getElementById('summarySection').scrollIntoView({ behavior: 'smooth' });
        }

        // Enviar para WhatsApp
        function sendWhatsApp() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientCPF = document.getElementById('clientCPF').value.trim();
            const installments = parseInt(document.getElementById('installmentsRange').value);
            const hasEntry = financingType === 'yes';
            const totalProducts = calculateTotalProducts();
            const montagemValue = calculateMontagemValue();
            const totalFinanciado = totalProducts + (montagemType === 'parcelar' ? montagemValue : 0);
            const financedValue = totalFinanciado - currentEntry;
            
            let productsText = '';
            const productElements = document.querySelectorAll('.product-item');
            productElements.forEach((productElement, index) => {
                const nameInput = productElement.querySelector('.product-name');
                const valueInput = productElement.querySelector('.product-value');
                const name = nameInput.value.trim() || `M√≥vel ${index + 1}`;
                const value = getCurrencyValue(valueInput.value);
                productsText += `‚Ä¢ ${name} - ${formatCurrencyValue(value)}\n`;
            });
            
            // Calcula datas
            const today = new Date();
            const firstPayment = new Date(today);
            firstPayment.setMonth(firstPayment.getMonth() + 1);
            const lastPayment = new Date(firstPayment);
            lastPayment.setMonth(lastPayment.getMonth() + installments - 1);
            
            const message = `*ü™ë OR√áAMENTO - M√ìVEIS COM MONTAGEM*\n\n` +
                           `*Data:* ${today.toLocaleDateString('pt-BR')}\n` +
                           `*Cliente:* ${clientName}\n` +
                           `*CPF:* ${clientCPF}\n\n` +
                           `*M√ìVEIS:*\n${productsText}\n` +
                           `*TOTAL M√ìVEIS: ${formatCurrencyValue(totalProducts)}*\n` +
                           `*MONTAGEM: ${formatCurrencyValue(montagemValue)}*\n` +
                           `*Forma: ${montagemType === 'parcelar' ? 'Parcelada' : '√Ä vista'}*\n` +
                           `${hasEntry ? `*Entrada:* ${formatCurrencyValue(currentEntry)}\n` : ''}` +
                           `${hasEntry ? `*Valor Financiado:* ${formatCurrencyValue(financedValue)}\n` : ''}` +
                           `*Parcelas:* ${installments}x de ${document.getElementById('installmentDisplay').textContent}\n` +
                           `*1¬™ Parcela:* ${firstPayment.toLocaleDateString('pt-BR')}\n` +
                           `*√öltima Parcela:* ${lastPayment.toLocaleDateString('pt-BR')}\n\n` +
                           `_*Condi√ß√µes sujeitas √† an√°lise de cr√©dito*_\n` +
                           `üìû *Encomenda Palotina*\n` +
                           `üíö https://wa.me/554498408460`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/554498408460?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // Reset da calculadora
        function resetCalculator() {
            if (confirm('Deseja come√ßar uma nova simula√ß√£o?')) {
                document.getElementById('clientName').value = '';
                document.getElementById('clientCPF').value = '';
                document.getElementById('customEntry').value = '';
                setFinancingType('no');
                setMontagemType('parcelar');
                document.getElementById('installmentsRange').value = 1;
                document.getElementById('summarySection').classList.add('hidden');
                document.getElementById('whatsappButton').classList.add('hidden');
                
                // Remove todos os m√≥veis exceto o primeiro
                const productsContainer = document.getElementById('productsContainer');
                const firstProduct = productsContainer.querySelector('.product-item');
                
                productsContainer.innerHTML = '';
                if (firstProduct) {
                    productsContainer.appendChild(firstProduct);
                    firstProduct.querySelector('.product-name').value = '';
                    firstProduct.querySelector('.product-value').value = '';
                }
                
                productCount = 1;
                currentEntry = 0;
                updateCalculations();
            }
        }

        // Formata√ß√£o autom√°tica do CPF
        document.getElementById('clientCPF').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.substring(0, 11);
            if (value.length > 3) value = value.replace(/^(\d{3})(\d)/, '$1.$2');
            if (value.length > 6) value = value.replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3');
            if (value.length > 9) value = value.replace(/^(\d{3})\.(\d{3})\.(\d{3})(\d)/, '$1.$2.$3-$4');
            e.target.value = value;
        });
    </script>
</body>
</html>